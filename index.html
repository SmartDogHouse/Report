<!DOCTYPE html>
<html  lang="it"  dir="ltr">

    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>SmartDogHouse</title>
        <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon">
        <link rel="apple-touch-icon-precomposed" href="images/apple-touch-icon.png">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/uikit/2.26.4/css/uikit.gradient.css">

        <link rel="stylesheet" href="style.css">
        <link href="https://vjs.zencdn.net/5.4.4/video-js.css" rel="stylesheet" />
        <script src="https://code.jquery.com/jquery-2.2.1.min.js"></script>
        <script src="./pandoc-uikit/uikit.js"></script>
        <script src="./pandoc-uikit/scripts.js"></script>
        <script src="./pandoc-uikit/jquery.sticky-kit.js"></script>

        <meta name="generator" content="pandoc-uikit" />
                <meta name="author" content="Gyordan Caminati" />
                <meta name="author" content="Sara Kiade" />
                <meta name="author" content="Igor Lirussi" />
                        <title>SmartDogHouse</title>
        <style type="text/css">code{white-space: pre;}</style>
                                <link rel="stylesheet" href="./pandoc-uikit/uikit.css" />
                                          <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" type="text/javascript"></script>
                               
    </head>

    <body>


        <div class="uk-container uk-container-center uk-margin-top uk-margin-large-bottom">

                        <div class="uk-grid" data-uk-grid-margin>
                <div class="uk-width-1-1">
                    <h1 class="uk-heading-large">SmartDogHouse</h1>
                                                            <p class="uk-text-large">Gyordan Caminati</p>
                                        <p class="uk-text-large">Sara Kiade</p>
                                        <p class="uk-text-large">Igor Lirussi</p>
                                    </div>
            </div>
            
            <div class="uk-grid" data-uk-grid-margin >          
                <div class="uk-width-medium-1-4">
                    <div class="uk-overflow-container" data-uk-sticky="{top:25,media: 768}">
                        <div class="uk-panel uk-panel-box menu-begin" >

                                                        <ul>
                                                        <li><a href="#foointroduzione"><span class="toc-section-number">1</span> Introduzione</a>
                                                        <ul>
                                                        <li><a href="#foooverview"><span class="toc-section-number">1.1</span> Overview</a></li>
                                                        <li><a href="#fooproblemi"><span class="toc-section-number">1.2</span> Problemi</a></li>
                                                        <li><a href="#fooobiettivi"><span class="toc-section-number">1.3</span> Obiettivi</a></li>
                                                        </ul></li>
                                                        <li><a href="#foostato-dellarte"><span class="toc-section-number">2</span> Stato dell&#x2019;Arte</a></li>
                                                        <li><a href="#fooanalisi-dei-requisiti"><span class="toc-section-number">3</span> Analisi dei Requisiti</a>
                                                        <ul>
                                                        <li><a href="#foorequisiti-di-business"><span class="toc-section-number">3.1</span> Requisiti di Business</a></li>
                                                        <li><a href="#foorequisiti-utente"><span class="toc-section-number">3.2</span> Requisiti Utente</a>
                                                        <ul>
                                                        <li><a href="#foouser-stories"><span class="toc-section-number">3.2.1</span> User stories</a></li>
                                                        </ul></li>
                                                        <li><a href="#foorequisiti-funzionali"><span class="toc-section-number">3.3</span> Requisiti Funzionali</a>
                                                        <ul>
                                                        <li><a href="#foocasi-duso"><span class="toc-section-number">3.3.1</span> Casi d&#x2019;uso</a></li>
                                                        <li><a href="#fooapplicativo-web"><span class="toc-section-number">3.3.2</span> Applicativo web</a></li>
                                                        <li><a href="#fooopzionale-collare"><span class="toc-section-number">3.3.3</span> Opzionale: collare</a></li>
                                                        <li><a href="#foostrumentazione-gabbia"><span class="toc-section-number">3.3.4</span> Strumentazione gabbia</a></li>
                                                        <li><a href="#foostrumentazione-videosorveglianza"><span class="toc-section-number">3.3.5</span> Strumentazione videosorveglianza</a></li>
                                                        </ul></li>
                                                        <li><a href="#foorequisiti-non-funzionali"><span class="toc-section-number">3.4</span> Requisiti non Funzionali</a>
                                                        <ul>
                                                        <li><a href="#foodi-sistema"><span class="toc-section-number">3.4.1</span> Di Sistema</a></li>
                                                        <li><a href="#foodella-sensoristica"><span class="toc-section-number">3.4.2</span> Della Sensoristica</a></li>
                                                        </ul></li>
                                                        <li><a href="#foorequisiti-implementativi"><span class="toc-section-number">3.5</span> Requisiti Implementativi</a>
                                                        <ul>
                                                        <li><a href="#foometodologie-e-tecnologie-utilizzate"><span class="toc-section-number">3.5.1</span> Metodologie e Tecnologie Utilizzate</a></li>
                                                        </ul></li>
                                                        </ul></li>
                                                        <li><a href="#foodesign-architetturale"><span class="toc-section-number">4</span> Design Architetturale</a>
                                                        <ul>
                                                        <li><a href="#fooarchitettura-generale"><span class="toc-section-number">4.1</span> Architettura Generale</a></li>
                                                        <li><a href="#fooscelte-tecnologiche-cruciali"><span class="toc-section-number">4.2</span> Scelte Tecnologiche Cruciali</a>
                                                        <ul>
                                                        <li><a href="#fooaws"><span class="toc-section-number">4.2.1</span> AWS</a></li>
                                                        <li><a href="#fooprotocolli-di-comunicazione"><span class="toc-section-number">4.2.2</span> Protocolli di comunicazione</a></li>
                                                        <li><a href="#foomicrocontrollori-e-soc"><span class="toc-section-number">4.2.3</span> Microcontrollori e Soc</a></li>
                                                        </ul></li>
                                                        <li><a href="#foopattern-architetturali-utilizzati"><span class="toc-section-number">4.3</span> Pattern Architetturali Utilizzati</a>
                                                        <ul>
                                                        <li><a href="#fooclient-server"><span class="toc-section-number">4.3.1</span> Client-Server</a></li>
                                                        <li><a href="#foopusblish-subscribe"><span class="toc-section-number">4.3.2</span> Pusblish-Subscribe</a></li>
                                                        <li><a href="#foomaster-slave"><span class="toc-section-number">4.3.3</span> Master-Slave</a></li>
                                                        <li><a href="#fooscheduling-cooperativo"><span class="toc-section-number">4.3.4</span> Scheduling Cooperativo</a></li>
                                                        <li><a href="#foostate-machine"><span class="toc-section-number">4.3.5</span> State Machine</a></li>
                                                        </ul></li>
                                                        </ul></li>
                                                        <li><a href="#foodesign-di-dettaglio"><span class="toc-section-number">5</span> Design di Dettaglio</a>
                                                        <ul>
                                                        <li><a href="#foodesign-gestione-cibo-e-acqua"><span class="toc-section-number">5.1</span> Design Gestione Cibo e Acqua</a>
                                                        <ul>
                                                        <li><a href="#fooacqua"><span class="toc-section-number">5.1.1</span> Acqua</a></li>
                                                        <li><a href="#foocibo"><span class="toc-section-number">5.1.2</span> Cibo</a></li>
                                                        </ul></li>
                                                        <li><a href="#foodesign-monitoraggio-parametri-vitali"><span class="toc-section-number">5.2</span> Design Monitoraggio Parametri Vitali</a></li>
                                                        <li><a href="#foodesign-videosorveglianza"><span class="toc-section-number">5.3</span> Design Videosorveglianza</a></li>
                                                        <li><a href="#foodesign-del-database"><span class="toc-section-number">5.4</span> Design del Database</a>
                                                        <ul>
                                                        <li><a href="#foodefinizione-di-un-er"><span class="toc-section-number">5.4.1</span> Definizione di un ER</a></li>
                                                        <li><a href="#fooindividuazione-degli-accessi"><span class="toc-section-number">5.4.2</span> Individuazione degli accessi</a></li>
                                                        <li><a href="#foodefinizione-dei-pattern-di-primary-key-e-sort-key"><span class="toc-section-number">5.4.3</span> Definizione dei pattern di Primary Key e Sort Key</a></li>
                                                        <li><a href="#foointroduzione-di-indici-e-campi-aggiuntivi"><span class="toc-section-number">5.4.4</span> Introduzione di indici e campi aggiuntivi</a></li>
                                                        </ul></li>
                                                        <li><a href="#foodesign-webapp"><span class="toc-section-number">5.5</span> Design WebApp</a></li>
                                                        <li><a href="#foodesign-serverless-application"><span class="toc-section-number">5.6</span> Design Serverless Application</a></li>
                                                        </ul></li>
                                                        <li><a href="#fooimplementazione"><span class="toc-section-number">6</span> Implementazione</a>
                                                        <ul>
                                                        <li><a href="#foosoftware-microcontrollori"><span class="toc-section-number">6.1</span> Software Microcontrollori</a>
                                                        <ul>
                                                        <li><a href="#foogestione-cibo-e-acqua"><span class="toc-section-number">6.1.1</span> Gestione Cibo e Acqua</a></li>
                                                        <li><a href="#foomonitoraggio-parametri-vitali"><span class="toc-section-number">6.1.2</span> Monitoraggio Parametri Vitali</a></li>
                                                        </ul></li>
                                                        <li><a href="#foosoftware-videosorveglianza"><span class="toc-section-number">6.2</span> Software Videosorveglianza</a>
                                                        <ul>
                                                        <li><a href="#foomotion-detection"><span class="toc-section-number">6.2.1</span> Motion Detection</a></li>
                                                        <li><a href="#fooobject-detection"><span class="toc-section-number">6.2.2</span> Object Detection</a></li>
                                                        </ul></li>
                                                        <li><a href="#fooweb-app"><span class="toc-section-number">6.3</span> Web App</a>
                                                        <ul>
                                                        <li><a href="#fooconsiderazioni-tecnologiche"><span class="toc-section-number">6.3.1</span> Considerazioni tecnologiche</a></li>
                                                        <li><a href="#foonote-sul-codice"><span class="toc-section-number">6.3.2</span> Note sul codice</a></li>
                                                        <li><a href="#foodifficolt&#xE0;-durante-lo-sviluppo"><span class="toc-section-number">6.3.3</span> Difficolt&#xE0; durante lo sviluppo</a></li>
                                                        <li><a href="#foodeployment"><span class="toc-section-number">6.3.4</span> Deployment</a></li>
                                                        </ul></li>
                                                        <li><a href="#foofunzioni-serverless"><span class="toc-section-number">6.4</span> Funzioni Serverless</a>
                                                        <ul>
                                                        <li><a href="#foodeployment-1"><span class="toc-section-number">6.4.1</span> Deployment</a></li>
                                                        </ul></li>
                                                        <li><a href="#foodatabase-dynamodb"><span class="toc-section-number">6.5</span> Database DynamoDB</a>
                                                        <ul>
                                                        <li><a href="#footool-utilizzati"><span class="toc-section-number">6.5.1</span> Tool utilizzati</a></li>
                                                        </ul></li>
                                                        <li><a href="#fooimmagini-prototipi"><span class="toc-section-number">6.6</span> Immagini prototipi</a></li>
                                                        </ul></li>
                                                        <li><a href="#footesting-e-performance"><span class="toc-section-number">7</span> Testing e Performance</a>
                                                        <ul>
                                                        <li><a href="#fooautomazione-gabbia-e-monitoraggio-salute"><span class="toc-section-number">7.1</span> Automazione Gabbia e Monitoraggio Salute</a>
                                                        <ul>
                                                        <li><a href="#foohardware-1"><span class="toc-section-number">7.1.1</span> Hardware</a></li>
                                                        </ul></li>
                                                        <li><a href="#foovideosorveglianza"><span class="toc-section-number">7.2</span> Videosorveglianza</a>
                                                        <ul>
                                                        <li><a href="#foohardware-2"><span class="toc-section-number">7.2.1</span> Hardware</a></li>
                                                        <li><a href="#foosoftware"><span class="toc-section-number">7.2.2</span> Software</a></li>
                                                        </ul></li>
                                                        </ul></li>
                                                        <li><a href="#fooanalisi-di-deployment-su-larga-scala"><span class="toc-section-number">8</span> Analisi di Deployment su Larga Scala</a>
                                                        <ul>
                                                        <li><a href="#fooanalisi-interna"><span class="toc-section-number">8.1</span> Analisi Interna</a>
                                                        <ul>
                                                        <li><a href="#fooadozione-di-hw-specifico"><span class="toc-section-number">8.1.1</span> Adozione di HW specifico</a></li>
                                                        <li><a href="#foocentralina-controllo"><span class="toc-section-number">8.1.2</span> Centralina controllo</a></li>
                                                        </ul></li>
                                                        <li><a href="#fooanalisi-esterna"><span class="toc-section-number">8.2</span> Analisi Esterna</a></li>
                                                        <li><a href="#fooanalisi-complessiva"><span class="toc-section-number">8.3</span> Analisi complessiva</a>
                                                        <ul>
                                                        <li><a href="#foosicurezza"><span class="toc-section-number">8.3.1</span> Sicurezza</a></li>
                                                        </ul></li>
                                                        </ul></li>
                                                        <li><a href="#foopiano-di-lavoro"><span class="toc-section-number">9</span> Piano di lavoro</a>
                                                        <ul>
                                                        <li><a href="#foocontributi"><span class="toc-section-number">9.1</span> Contributi</a></li>
                                                        </ul></li>
                                                        <li><a href="#foosprints"><span class="toc-section-number">10</span> Sprints</a>
                                                        <ul>
                                                        <li><a href="#foosvolgimento"><span class="toc-section-number">10.1</span> Svolgimento</a></li>
                                                        <li><a href="#foosprint-0"><span class="toc-section-number">10.2</span> Sprint 0</a></li>
                                                        <li><a href="#foosprint-1"><span class="toc-section-number">10.3</span> Sprint 1</a></li>
                                                        <li><a href="#foosprint-2"><span class="toc-section-number">10.4</span> Sprint 2</a></li>
                                                        <li><a href="#foosprint-3"><span class="toc-section-number">10.5</span> Sprint 3</a></li>
                                                        <li><a href="#foosprint-4"><span class="toc-section-number">10.6</span> Sprint 4</a></li>
                                                        </ul></li>
                                                        <li><a href="#fooconclusioni"><span class="toc-section-number">11</span> Conclusioni</a>
                                                        <ul>
                                                        <li><a href="#foosviluppi-futuri"><span class="toc-section-number">11.1</span> Sviluppi Futuri</a></li>
                                                        </ul></li>
                                                        </ul>
                            
                        </div>
                    </div>
                </div>

                <div class="uk-width-medium-3-4">
<section id="foointroduzione" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introduzione</h1>
<p>Smart DogHouse &#xE8; un progetto che nasce con l&#x2019;intento di migliorare le condizioni dei cani che si trovano ospiti di un <strong>canile</strong>, mediante l&#x2019;introduzione di un <strong>supporto informatico</strong> che possa, da un lato, <strong>facilitare operazioni</strong> che gi&#xE0; prima venivano svolte e dall&#x2019;altro <strong>introdurre nuovi strumenti</strong> che vadano a migliorare la gestione del canile.</p>
<section id="foooverview" class="level2" data-number="1.1">
<h2 data-number="1.1"><span class="header-section-number">1.1</span> Overview</h2>
<p>Come riferimento &#xE8; stato preso in considerazione il <strong>canile comunale di Pisa</strong>, il quale gestore si &#xE8; offerto di indirizzarci permettendoci di rivolgerci a lui per avere feedback e indicazioni basate su <strong>esperienze reali</strong>.</p>
<p>L&#x2019;idea ha avuto origine dopo un colloquio con il gestore del canile che, raccontando la propria esperienza, ha evidenziato alcuni <strong>problemi</strong> che riscontra nello svolgimento del proprio lavoro, molti dei quali sono risolvibili attraverso gli <strong>strumenti</strong> e le <strong>competenze</strong> che abbiamo a disposizione. Successivamente, le informazioni ottenute dal canile di Pisa sono state confrontate e integrate a fronte di un colloquio con il <strong>canile Comunale di Cesena</strong>, la quale consulenza &#xE8; stata indispensabile per riuscire a discernere gli <strong>aspetti comuni</strong> alla maggior parte dei canili da quelle che invece sono <strong>peculiarit&#xE0;</strong> di un canile specifico. Questa capacit&#xE0; di <strong>astrazione</strong> ci ha permesso di definire meglio gli <strong>obiettivi</strong>. Anche se questo non pu&#xF2; essere considerato un progetto su commissione, abbiamo fede nel fatto che una volta sviluppata la nostra soluzione, essa possa essere utilizzata come base per sviluppare altri sistemi o rendere pi&#xF9; tecnologici canili e gattili che riscontrano le stesse difficolt&#xE0;.</p>
<figure>
<img src="Images/canili.png" id="foofig:Canili" style="width:80.0%" alt="I due canili interpellati in qualit&#xE0; di esperti del dominio" /><figcaption aria-hidden="true">I due canili interpellati in qualit&#xE0; di <strong>esperti del dominio</strong></figcaption>
</figure>
</section>
<section id="fooproblemi" class="level2" data-number="1.2">
<h2 data-number="1.2"><span class="header-section-number">1.2</span> Problemi</h2>
<p>Il canile di Pisa ospita circa una <strong>sessantina</strong> di cani e gatti di diversa <strong>taglia</strong>, <strong>randagi</strong> o <strong>abbandonati</strong>, che vengono prelevati dagli addetti del canile su segnalazione dei cittadini. I cani restano poi in cura finch&#xE9; non vengono <strong>adottati</strong>, mentre i gatti vengono <strong>rilasciati</strong> subito dopo aver ricevuto le cure mediche ed essersi ripresi. Ad occuparsi della salute dei cani &#xE8; un <strong>responsabile sanitario</strong> sempre presente nella struttura, che coordina alcuni <strong>veterinari</strong> convenzionati con la struttura. La situazione al canile di Cesena &#xE8; similare, con la differenza che quest&#x2019;ultimo non si occupa pi&#xF9; del recupero di gatti randagi e il responsabile sanitario non coordina altri veterinari ma si occupa <strong>in autonomia</strong> di tutto ci&#xF2; che riguarda la salute del cane, dai problemi di routine alle <strong>operazioni chirurgiche</strong>.</p>
<p>I principali problemi che vengono attualmente riscontrati sono i seguenti:</p>
<ul>
<li><p><strong>responsabile sanitario:</strong> il responsabile sanitario e alcuni veterinari convenzionati, risiedono all&#x2019;interno del canile. Attualmente non &#xE8; possibile monitorare in maniera continuativa lo stato di salute di un animale. Questo spesso si traduce in un intervento tardivo che porta con s&#xE9; delle limitazioni che con una diagnosi pi&#xF9; veloce si sarebbero potute evitare.</p></li>
<li><p><strong>Rifornimento e consumi di cibo ed acqua:</strong> in entrambi i canili la maggior parte del lavoro manuale viene svolta dai volontari che prestano attivit&#xE0; in forma gratuita e fortemente discontinua. Non &#xE8; possibile sapere a priori quanti volontari si presenteranno a dare una mano, ed essendo in tanti non &#xE8; nemmeno possibile sapere chi ha svolto quali mansioni. Operazioni come il rifornimento di cibo ed acqua vanno quindi monitorate personalmente dal gestore che deve recarsi fisicamente nelle gabbie per controllare gli approvvigionamenti; inoltre non &#xE8; nemmeno possibile conoscere la quantit&#xE0; di cibo ed acqua consumata da un cane, il che rende pi&#xF9; difficile individuare i segnali alimentari che sono sintomi di alcuni problemi di salute.</p></li>
<li><p><strong>Sorveglianza:</strong> n&#xE9; il canile di Pisa, n&#xE9; quello di Cesena, attualmente, dispongono di un sistema di sorveglianza da remoto, pertanto nel momento in cui si verificano furti, effrazioni ed atti vandalici, non &#xE8; possibile risalire agevolmente al colpevole. E&#x2019; assente anche un sistema che possa permettere di sorvegliare da remoto cani che hanno particolari problemi. Nel caso di una gravidanza che volge al termine, ad esempio, il personale del canile &#xE8; costretto a recarsi frequentemente sul luogo, durante la notte, per controllare se ha avuto inizio il travaglio o se si stanno verificando delle complicanze. Questa necessit&#xE0; crea un disagio al personale che si trova a doversi recare in canile fuori dall&#x2019;orario di lavoro.</p></li>
<li><p><strong>Assenza di supporto informatico</strong>: attualmente nessuno dei due canili dispone di un&#x2019;infrastruttura informatica gi&#xE0; presente, da poter integrare; inoltre non dispongono nemmeno di un gestionale che dia supporto nella catalogazione degli animali presi in cura.</p></li>
</ul>
</section>
<section id="fooobiettivi" class="level2" data-number="1.3">
<h2 data-number="1.3"><span class="header-section-number">1.3</span> Obiettivi</h2>
<p>L&#x2019;obiettivo &#xE8; quello di rendere il canile pi&#xF9; "Smart", introducendo della strumentazione che permetta di risolvere in maniera parziale o totale le problematiche descritte precedentemente, mantenendo un costo accessibile.</p>
<figure>
<img src="Images/cani.png" id="foofig:Obbiettivi" style="width:100.0%" alt="Obbiettivi principali" /><figcaption aria-hidden="true">Obbiettivi principali</figcaption>
</figure>
<p>Nello specifico si vogliono incontrare le esigenze del gestore e degli addetti, agevolando le operazioni di:</p>
<ul>
<li><p><strong>monitoraggio dello stato di salute dei cani</strong> tramite:</p>
<ul>
<li><p>rilevazione dei <strong>consumi</strong> di cibo e acqua;</p></li>
<li><p>monitoraggio del <strong>comportamento</strong> del cane.</p></li>
</ul>
<p>In questo modo &#xE8; possibile cogliere in maniera preventiva segnali che possono indicare un problema di salute e aiutare il <strong>responsabile sanitario</strong> nella risoluzione e nella diagnosi dello stesso.</p></li>
<li><p>automatizzazione delle operazioni di <strong>cura quotidiana</strong> attraverso:</p>
<ul>
<li><p>automatizzazione del <strong>rifornimento</strong> di cibo e acqua</p></li>
<li><p>possibilit&#xE0; di scegliere, per ciascun cane, la <strong>quantit&#xE0;</strong> del cibo da somministrare e la <strong>frequenza</strong>.</p></li>
</ul>
<p>In questo modo &#xE8; possibile gestire in maniera pi&#xF9; precisa l&#x2019;alimentazione dei cani e impostare delle quantit&#xE0; di cibo particolari in caso di condizioni di salute che richiedono un particolare piano alimentare, sollevando da questo incarico i volontari, che svolgono un&#x2019;attivit&#xE0; non tracciabile e discontinua. Inoltre, sar&#xE0; possibile per il <strong>responsabile sanitario</strong> consultare i dati riguardanti l&#x2019;alimentazione del cane e, di conseguenza, fornire diagnosi pi&#xF9; precise.</p></li>
<li><p><strong>sorveglianza globale del canile da remoto</strong>: l&#x2019;introduzione di un sistema di sorveglianza permetter&#xE0; a chi di competenza di monitorare lo stato del canile anche da casa.</p></li>
<li><p><strong>Mantenimento dello storico dei dati registrati</strong>: in questo modo sar&#xE0; possibile consultare sia le informazioni riguardanti i cani che i dati che riguardano le condizioni del canile, permettendo anche di fare dei confronti su base temporale;</p></li>
<li><p><strong>consultazione dei dati acquisiti ed elaborati:</strong> verr&#xE0; fornita la possibilit&#xE0; di accedere allo storico dei dati medici su un Database, affinch&#xE9; il veterinario abbia una visione globale del quadro medico e possa velocemente filtrare le informazioni anche se non ha seguito il paziente dall&#x2019;inizio.</p></li>
<li><p><em><span>[</span>optional<span>]</span></em> <strong>monitoraggio approfondito dei parametri vitali</strong>: mediante l&#x2019;installazione di sensoristica che permetta il monitoraggio di temperatura, battiti, movimento, ecc&#x2026; sar&#xE0; possibile tenere ulteriormente sott&#x2019;occhio cani che si trovano in condizioni di salute che necessitano di particolari attenzioni.</p></li>
<li><p><strong>Introduzione di un sistema informatico:</strong> poich&#xE9; non vi &#xE8; un sistema informatico preesistente da integrare e vi sono poche disponibilit&#xE0; economiche, si &#xE8; pensato di avvalersi di una piattaforma cloud sulla quale &#xE8; possibile mantenere lo storico ed operare tramite l&#x2019;utilizzo di un broker MQTT per la comunicazione con sensori e attuatori. Questa soluzione &#xE8; stata indicata come preferibile dal canile che ritiene pi&#xF9; accessibile pagare mensilmente un servizio piuttosto che investire in una soluzione ad hoc.</p></li>
</ul>
</section>
</section>
<section id="foostato-dellarte" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Stato dell&#x2019;Arte</h1>
<p>Il topic scelto non gode di particolare attenzione in letteratura. Dalle informazioni che abbiamo raccolto su ricerche, studi e applicazione di <strong>idee similari</strong> alla nostra &#xE8; emerso quanto segue:</p>
<ul>
<li><p><strong>Automazione</strong>: sono state condotte alcune ricerche che riguardano interventi di <strong>automazione</strong> del sistema di alimentazione per gli allevamenti, ma si tratta di progetti con un forte imprinting <strong>economico</strong>.</p></li>
<li><p><strong>Distribuzione del cibo</strong>: alcune soluzioni commerciali offrono la <strong>distribuzione automatica</strong> del cibo ad orari <strong>temporizzati</strong>, senza possibilit&#xE0; di <strong>dosaggio</strong> o di rilevamento dei <strong>consumi</strong>.</p></li>
<li><p><strong>Monitoraggio parametri</strong>: in ambito commerciale esistono soluzioni che si focalizzano soprattutto sul <strong>monitoraggio</strong> e la <strong>notifica</strong> dei <strong>parametri vitali</strong> dell&#x2019;animale.</p></li>
<li><p><strong>Fusione dei due ambiti</strong>: <strong>non</strong> siamo riusciti a trovare progetti che fondono i due ambiti come invece fa la nostra proposta. La <strong>nostra</strong> soluzione, infatti, tenta di <strong>fondere</strong> le due idee e di proporre un <strong>sistema remoto</strong> e <strong>scalabile</strong>, che monitori i <strong>parametri vitali</strong>, che possa anche fornire un automatismo alla gestione del <strong>cibo</strong> e dell&#x2019;<strong>acqua</strong> erogati al cane e, inoltre, che sia in grado sia di <strong>intercettare</strong> la presenza di <strong>sintomi</strong> riguardanti il consumo di cibo e acqua in base all&#x2019;<strong>analisi</strong> dei dati raccolti.</p></li>
</ul>
<p>Per quanto riguarda, invece, l&#x2019;ambito dei <strong>sensori</strong>; lo stato dell&#x2019;arte &#xE8; in continua evoluzione, e possiamo trovare:</p>
<ul>
<li><p><strong><a href="https://ciigar.csc.ncsu.edu/files/bib/Brugarolas2015-DogHeartMonitor.pdf">Sensori ad hoc</a></strong>: impiegati nell&#x2019;ambito della <strong>ricerca</strong> per il monitoraggio dei parametri vitali dei cani</p></li>
<li><p><strong><a href="https://petpace.com/">Collari smart</a></strong>: che si basano su un&#x2019;idea simile alla nostra ma sono sistemi <strong>proprietari</strong>, commercializzati come prodotti ad uso domestico, completi di gps e altri sensori e supportati da un&#x2019;<strong>applicazione</strong> che si rif&#xE0; a quelle per gli smartwatch. Il costo di questi collari &#xE8; dell&#x2019;ordine delle centinaia di euro e deve essere associato ad un <strong>abbonamento</strong> mensile o annuale.</p>
<p><span id="foofig:PetPace" label="fig:PetPace">[fig:PetPace]</span> <img src="Images/petpace.png" title="fig:" id="foofig:PetPace" style="width:60.0%" alt="Pet Pace: uno dei collari smart in commercio basati su un&#x2019;idea simile alla nostra" /></p></li>
</ul>
<p>I sensori di battiti tradizionali utilizzano un fascio luminoso per identificare la frequenza del battito cardiaco. Questa tecnologia si presta male per gli animali che presentano del pelo, come i cani, per questo sono in via di sviluppo sensori specifici che utilizzano principi diversi. Attualmente sono in corso delle <a href="https://vcs.vetmed.wsu.edu/research/clinical-studies/clinincal-studies-detail/vcs-clinical-studies/2017/06/28/new-ecg-technology">ricerche</a> su sensori di altro genere che possano essere adatti anche anche ai cani.</p>
<div class="tcolorbox">
<div class="frame">
<p><span>Lorem Ipsum</span></p>
<div class="multicols">
<p><span>2</span> I sensori di battiti tradizionali utilizzano un fascio luminoso per identificare la frequenza del battito cardiaco. Questa tecnologia si presta male per gli animali che presentano del pelo, come i cani, per questo sono in via di sviluppo sensori specifici che utilizzano principi diversi. Attualmente sono in corso delle <a href="https://vcs.vetmed.wsu.edu/research/clinical-studies/clinincal-studies-detail/vcs-clinical-studies/2017/06/28/new-ecg-technology">ricerche</a> su sensori di altro genere che possano essere adatti anche anche ai cani. Nonostante ci&#xF2; la nostra soluzione utilizza un sensore <a href="https://www.amazon.it/Haljia-Sensore-frequenza-cardiaca-Raspberry/dp/B01CBGH4N6">classico</a>. Presupponendo che si utilizzi un collare smart solo per gli animali che, a causa del loro stato di salute, sono in osservazione, &#xE8; possibile supporre che il pelo possa essere rasato durante il periodo di degenza.</p>
<figure>
<img src="Images/canili.png" id="foofig:doggos" style="width:30.0%" alt="I due canili interpellati in qualit&#xE0; di esperti del dominio" /><figcaption aria-hidden="true">I due canili interpellati in qualit&#xE0; di <strong>esperti del dominio</strong></figcaption>
</figure>
</div>
</div>
</div>
<p>Nonostante ci&#xF2; la nostra soluzione utilizza un sensore <a href="https://www.amazon.it/Haljia-Sensore-frequenza-cardiaca-Raspberry/dp/B01CBGH4N6">classico</a>. Presupponendo che si utilizzi un collare smart solo per gli animali che, a causa del loro stato di salute, sono in osservazione, &#xE8; possibile supporre che il pelo possa essere rasato durante il periodo di degenza.</p>
<p>Per quanto riguarda le soluzioni riguardanti l&#x2019;automatizzazione del cibo e dell&#x2019;acqua le soluzioni commerciali sono davvero <a href="https://www.fruugo.it/alimentatore-automatico-per-animali-domestici-a-43-l-capacita-alimentatore-intelligente-per-alimentazione-intelligente-per-lalimentazione-del-tempo-e-razionale-con-telecamera-telecomandato-tipo-di-lusso/p-55093501-111996468?language=it&amp;ac=croud">tante</a> molto simili.</p>
<p>Da questo punto di vista la nostra soluzione pu&#xF2; dirsi all&#x2019;avanguardia pur non essendo incentrata sull&#x2019;uso domestico. Grossa parte di questi sistemi, infatti, usano: sensori del livello dell&#x2019;acqua, bilance e sensori luminosi. Inoltre alcuni sistemi pi&#xF9; all&#x2019;avanguardia consentono, tramite l&#x2019;utilizzo di tecnologie come <strong>BLE</strong>, di monitorare da <strong>App</strong> i consumi e gli allarmi, non fornendo per&#xF2; alcun tipo di inferenza.</p>
<p>Attualmente il nostro sistema fornisce un&#x2019;inferenza banale, ci&#xF2; non toglie che in un futuro sviluppo associato ad uno studio comportamentale dell&#x2019;animale non sia possibile implementare inferenze pi&#xF9; complesse.</p>
<p>Quanto appena detto costituisce lo stato dell&#x2019;arte nell&#x2019;uso commerciale. Per quanto riguarda lo specifico ambito del canile, invece, non sono state trovate applicazioni simili.</p>
<p>Per avere una visione pi&#xF9; chiara di quello che &#xE8; lo stato dei canili in Italia ci siamo rivolti a due <strong>canili</strong>:</p>
<ul>
<li><p><strong>ACPA - Canile intercomunale di Cesena</strong> Ci siamo recati fisicamente al canile di Cesena per discutere e toccare con mano lo stato tecnologico dello stabile, questo per valutare la fattibilit&#xE0; e la bont&#xE0; della nostra soluzione.</p></li>
<li><p><strong>Canile intercomunale "Soffio di Vento"- Pisa</strong> Abbiamo contattato in via totalmente telematica il canile per comprendere se una soluzione del genere esistesse o fosse adottata da qualche parte e per avere una visione concreta dei problemi che vengono riscontrati per i quali avremmo potuto proporre una soluzione.</p></li>
</ul>
<p>Entrambe le fonti ci hanno confermato che almeno in Italia lo stato dei canili risulta essere tecnologicamente obsoleto. La soluzione proposta ha ricevuto un caloroso interesse da parte di entrambi i canili, con particolare entusiasmo per le rilevazioni dei consumi e il monitoraggio dei parametri vitali, con notifiche in caso di rilevazioni anomale. Attualmente i canili contattati sono privi di una qualunque forma di <strong>monitoraggio</strong>, o <strong>automatizzazione</strong> di qualunque genere. Il punto di forza di questo progetto risiede nella sua semplicit&#xE0; di dispiegamento, nelle tecnologie altamente accessibili e nel fatto che molti canili avrebbero il bisogno di una soluzione simile. Il <strong>collare</strong> e l&#x2019;<strong>inferenza</strong> sui consumi sono la parte che ha riscosso pi&#xF9; successo poich&#xE9; l&#x2019;automatizzazione presenta alcuni svantaggi. A detta del canile di Cesena dipende dalle norme del canile e dal modo con cui si vogliono addestrare i cani poich&#xE9; buona parte delle pratiche di addestramento ruota attorno al cibo, che viene utilizzato sia come premio che come modo per far si che l&#x2019;umano venga percepito come alpha. La pi&#xF9; grande critica mossa riguarda il fatto che se l&#x2019;animale viene nutrito in maniera automatica allora non sar&#xE0; abituato a ricevere cibo da persone, ed essendo l&#x2019;adozione dei cani lo scopo principe del canile &#xE8; probabile che il sistema automatizzato venga adottato solo da canili di grandezza medio-grande o la quale gestione non prevede l&#x2019;addestramento.</p>
</section>
<section id="fooanalisi-dei-requisiti" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Analisi dei Requisiti</h1>
<p>In questa fase sono stati individuati i <strong>requisiti del sistema</strong>, partendo dalle descrizioni di alto livello, ottenute dal committente durante il <strong>knowledge crunching</strong>. Successivamente si &#xE8; proceduto con un raffinamento che ha portato alla definizione di requisiti pi&#xF9; <strong>specifici</strong>, <strong>chiari</strong> e <strong>strutturati</strong>.</p>
<section id="foorequisiti-di-business" class="level2" data-number="3.1">
<h2 data-number="3.1"><span class="header-section-number">3.1</span> Requisiti di Business</h2>
<p>Si definiscono di seguito le aspettative del cliente e i requisiti che il prodotto dovr&#xE0; soddisfare, espressi con una terminologia ad elevato livello astrattivo.</p>
<ul>
<li><p>Il prodotto dovr&#xE0; <strong>diminuire l&#x2019;intervento umano</strong> necessario per la quotidiana cura degli ospiti (Riempimento ciotola acqua/cibo); la riduzione del lavoro deve essere maggiore o uguale al 30%.</p></li>
<li><p>Il prodotto dovr&#xE0; consentire di <strong>diminuire il lavoro su base volontaria</strong>, grazie alla riduzione delle operazioni di cura quotidiana, permettendo ai volontari di concentrarsi solo sulla socializzazione e lo svago dell&#x2019;animale. Diminuisce cos&#xEC; l&#x2019;interferenza al di fuori delle loro mansioni, e migliora la tracciabilit&#xE0; del lavoro svolto, essendo il lavoro volontario incostante e meno affidabile.</p></li>
<li><p>Opzionalmente il prodotto dovr&#xE0; <strong>fornire un monitoraggio a distanza</strong> degli animali ospitati. Questo consentir&#xE0; al personale incaricato di monitorare parametri come: frequenza cardiaca e temperatura corporea. Verr&#xE0; diminuito anche l&#x2019;intervento veterinario, non essendo necessaria la presenza in loco del professionista. La riduzione delle presenze dovr&#xE0; consentire di diminuire i costi di un valore maggiore o uguale al 10%.</p></li>
</ul>
</section>
<section id="foorequisiti-utente" class="level2" data-number="3.2">
<h2 data-number="3.2"><span class="header-section-number">3.2</span> Requisiti Utente</h2>
<p>Di seguito vengono riportate le richieste mosse dal cliente in maniera informale evitando termini tecnici, successivamente tali richieste saranno formalizzate per quanto possibile. Il prodotto dovr&#xE0; fornire:</p>
<ul>
<li><p>l&#x2019;accesso al sistema da <strong>qualunque dispositivo</strong> munito di connessione alla rete, anche esterna al canile</p></li>
<li><p><strong>prestazioni adeguate</strong> alle operazioni richieste (con soglie adeguate caso per caso), come il rilevare se il cane ha bisogno di cibo o acqua</p></li>
<li><p>un interfaccia intuitiva, comprensiva di una pagina per l&#x2019;accesso e un menu principale</p></li>
<li><p>uno <strong>storico</strong> per ogni animale</p></li>
<li><p>un a<strong>accesso rapido e reattivo</strong> evitando tempi troppo lunghi per le operazioni</p></li>
<li><p>un <strong>sistema di sorveglianza semi automatizzato</strong> in grado di identificare eventuali anomalie, come cani che escono senza permesso</p></li>
<li><p><strong>opzionalmente</strong> delle <strong>notifiche sullo stato di salute</strong> dell&#x2019;animale al personale</p></li>
<li><p>delle <strong>notifiche</strong> in caso di <strong>malfunzionamento</strong> del sistema stesso</p></li>
<li><p>delle <strong>notifiche</strong>, nel caso in cui il cibo sia in <strong>esaurimento</strong></p></li>
</ul>
<section id="foouser-stories" class="level3" data-number="3.2.1">
<h3 data-number="3.2.1"><span class="header-section-number">3.2.1</span> User stories</h3>
<p>Di seguito sono riportate tutte le <strong>user stories</strong> ritenute utili per lo sviluppo del prodotto.</p>
<ul>
<li><p>Come <strong>gestore</strong> voglio:</p>
<ul>
<li><p>poter <strong>visualizzare</strong> le i dati relativi all&#x2019;<strong>occupante</strong> di una <strong>gabbia</strong></p></li>
<li><p>voglio poter <strong>impostare</strong> i <strong>dati</strong> dell&#x2019;occupante di una gabbia</p></li>
<li><p>poter <strong>aggiungere un cane</strong> a una gabbia</p></li>
<li><p>poter <strong>rimuovere un cane</strong> da una gabbia</p></li>
<li><p>poter visualizzare i <strong>consumi TOTALI</strong> del canile</p></li>
<li><p><em>opzionalmente</em> poter <strong>visualizzare</strong> l&#x2019;<strong>umidit&#xE0;</strong> e la <strong>temperatura</strong> ambientale</p></li>
<li><p>poter <strong>impostare</strong> i dati relativi allo <strong>stato di salute</strong> di un cane</p></li>
<li><p>poter visualizzare i <strong>consumi di cibo</strong> relativi a un cane in un determinato lasso di tempo</p></li>
<li><p>poter visualizzare i <strong>consumi di acqua</strong> relativi a un cane in un determinato lasso di tempo</p></li>
</ul></li>
<li><p>Come <strong>responsabile sanitario</strong> voglio:</p>
<ul>
<li><p><em>opzionalmente</em> poter <strong>visualizzare i battiti</strong> di un cane</p></li>
<li><p><em>opzionalmente</em> ricevere una <strong>notifica</strong> in caso di rilevazione di <strong>anomalie</strong> nei <strong>battiti</strong> o nella di un cane</p></li>
<li><p><em>opzionalmente</em> poter <strong>visualizzare la temperatura corporea</strong> di un cane</p></li>
<li><p><em>opzionalmente</em> ricevere una <strong>notifica</strong> in caso di rilevazione di <strong>anomalie</strong> nella <strong>temperatura</strong> corporea di un cane</p></li>
<li><p><em>opzionalmente</em> poter <strong>impostare</strong> gli intervalli di <strong>temperatura e battiti</strong> fuori dai quali vi &#xE8; un&#x2019;anomalia</p></li>
<li><p>poter <strong>impostare</strong> gli intervalli delle <strong>quantit&#xE0; di cibo e acqua</strong> assunti, fuori dai quali vi &#xE8; un&#x2019;anomalia</p></li>
<li><p>ricevere una <strong>notifica</strong> in caso di <strong>anomalie</strong> nella quantit&#xE0; di <strong>acqua</strong> assunta da un cane</p></li>
<li><p>ricevere una <strong>notifica</strong> in caso di <strong>anomalie</strong> nella quantit&#xE0; di <strong>cibo</strong> assunto da un cane</p></li>
<li><p>poter <strong>impostare</strong> i dati relativi allo <strong>stato di salute</strong> di un cane</p></li>
<li><p>poter <strong>impostare la quantit&#xE0; di cibo</strong> da erogare a un cane</p></li>
<li><p>poter visualizzare i <strong>consumi di cibo</strong> relativi a un cane in un determinato lasso di tempo</p></li>
<li><p>poter visualizzare i <strong>consumi di acqua</strong> relativi a un cane in un determinato lasso di tempo</p></li>
</ul></li>
<li><p>Come <strong>addetto ai rifornimenti</strong> voglio:</p>
<ul>
<li><p>che la distribuzione di cibo agli animali sia automatizzata</p></li>
<li><p>che la distribuzione di acqua agli animali sia automatizzata</p></li>
<li><p>essere notificato se in una gabbia sta per esaurirsi il cibo</p></li>
<li><p>ricevere una notifica in caso di malfunzionamento al sistema</p></li>
<li><p>poter impostare la quantit&#xE0; di cibo da erogare a tutti i cani di una determinata taglia</p></li>
<li><p>poter <strong>impostare la quantit&#xE0; di cibo</strong> da erogare a un cane</p></li>
<li><p>poter visualizzare i <strong>consumi di cibo</strong> relativi a un cane in un determinato lasso di tempo</p></li>
<li><p>poter visualizzare i <strong>consumi di acqua</strong> relativi a un cane in un determinato lasso di tempo</p></li>
</ul></li>
<li><p>Come <strong>addetto alla sorveglianza</strong> voglio:</p>
<ul>
<li><p>poter visualizzare le immagini acquisite dalla videocamera di sorveglianza</p></li>
<li><p>notificato in caso di uscita non autorizzata di un cane</p></li>
<li><p><em>opzionalmente</em> essere notificato in caso di rilevazione di suoni forti o anomali</p></li>
<li><p><em>opzionalmente</em> poter visualizzare l&#x2019;umidit&#xE0; e la temperatura ambientale</p></li>
</ul></li>
</ul>
<p>Di seguito viene riportato lo schema, sotto-forma di diagramma di Venn, esplicativo delle intersezioni tra le User-Stories e le figure dell&#x2019;organigramma.</p>
<figure>
<img src="Miro/DiagrammaUserStories.jpg" style="width:100.0%" alt="Diagramma di Venn delle User-Stories" /><figcaption aria-hidden="true">Diagramma di Venn delle User-Stories</figcaption>
</figure>
</section>
</section>
<section id="foorequisiti-funzionali" class="level2" data-number="3.3">
<h2 data-number="3.3"><span class="header-section-number">3.3</span> Requisiti Funzionali</h2>
<section id="foocasi-duso" class="level3" data-number="3.3.1">
<h3 data-number="3.3.1"><span class="header-section-number">3.3.1</span> Casi d&#x2019;uso</h3>
<figure>
<img src="DrawIo/useCaseWholeSystem.png" style="width:90.0%" alt="Diagramma dei casi d&#x2019;uso del sistema, rappresenta le principali azioni effettuate degli attori" /><figcaption aria-hidden="true">Diagramma dei casi d&#x2019;uso del sistema, rappresenta le principali azioni effettuate degli attori</figcaption>
</figure>
<p>Si elencano i requisiti funzionali per ognuno dei seguenti macro-componenti:</p>
<ul>
<li><p>Applicativo web</p></li>
<li><p>Opzionale collare</p></li>
<li><p>Strumentazione gabbia</p></li>
<li><p>Strumentazione videosorveglianza</p></li>
</ul>
</section>
<section id="fooapplicativo-web" class="level3" data-number="3.3.2">
<h3 data-number="3.3.2"><span class="header-section-number">3.3.2</span> Applicativo web</h3>
<p>L&#x2019;applicativo web deve consentire ad ogni utente di accedere con una serie di credenziali, e dividere le operazioni consentite in base ai permessi concessi. Il sito &#xE8; suddiviso in tre pagine principali:</p>
<ul>
<li><p><strong>pagina di login</strong> La pagina iniziale a cui ogni utente deve far riferimento per effettuare l&#x2019;accesso. Sostanzialmente contiene solo gli elementi necessari per effettuare il <strong>login</strong>, non &#xE8; prevista una funzione di registrazione autonoma.</p></li>
<li><p><strong>home gestore</strong> Il gestore ha accesso alla pagina di amministrazione, dov&#x2019;&#xE8; possibile:</p>
<ul>
<li><p>registrare un nuovo utente</p></li>
<li><p>eliminare un utente</p></li>
<li><p>visualizzare le statistiche del canile</p></li>
</ul></li>
<li><p><strong>home addetto rifornimenti</strong> La schermata deve consentire di:</p>
<ul>
<li><p>visualizzare le eventuali notifiche</p></li>
<li><p>visualizzare i consumi di un cane</p></li>
<li><p>impostare la quantit&#xE0; di cibo adeguata per taglia di cane</p></li>
</ul></li>
<li><p><strong>home addetto sorveglianza</strong> La home del sorvegliante deve fornire:</p>
<ul>
<li><p>un accesso in diretta alle videocamere disponibili</p></li>
<li><p>deve essere possibile aggiungere o rimuovere una videocamera</p></li>
<li><p>visualizzare le notifiche se presenti</p></li>
</ul></li>
<li><p><strong>home altri addetti</strong> In un futuro sviluppo del prodotto &#xE8; certamente contemplata l&#x2019;aggiunta di altre mansioni o addetti.</p></li>
<li><p><strong>responsabile sanitario</strong> La pagina deve consentire di:</p>
<ul>
<li><p>visualizzare lo stato di salute di un cane</p></li>
<li><p>visualizzare i consumi di un cane</p></li>
<li><p>impostare la quantit&#xE0; di cibo per un cane degente o in terapia</p></li>
<li><p>aggiornare lo stato di salute di un cane</p></li>
</ul></li>
</ul>
<p>Nonostante un addetto possa ricoprire pi&#xF9; ruoli, &#xE8; stato scelto di modellare separatamente ogni mansione, questo consente: un maggiore controllo, rende pi&#xF9; chiara la struttura e aiuta il lettore nella comprensione. Inoltre l&#x2019;applicativo consentir&#xE0; ad un utente di detenere uno o pi&#xF9; ruoli, rendendo pi&#xF9; agevole l&#x2019;utilizzo.</p>
</section>
<section id="fooopzionale-collare" class="level3" data-number="3.3.3">
<h3 data-number="3.3.3"><span class="header-section-number">3.3.3</span> Opzionale: collare</h3>
<p>Il collare smart deve costantemente inviare aggiornamenti sui parametri vitali dell&#x2019;animale quali:</p>
<ul>
<li><p>La frequenza cardiaca</p></li>
<li><p>La temperatura dell&#x2019;animale</p></li>
</ul>
</section>
<section id="foostrumentazione-gabbia" class="level3" data-number="3.3.4">
<h3 data-number="3.3.4"><span class="header-section-number">3.3.4</span> Strumentazione gabbia</h3>
<p>La gabbia smart deve:</p>
<ul>
<li><p>monitorare il consumo di cibo e acqua del cane inviando aggiornamenti costanti</p></li>
<li><p>rifornire la ciotola di acqua quando troppo bassa</p></li>
<li><p>rifornire la ciotola di cibo con la quantit&#xE0; desiderata quando mancante</p></li>
<li><p>notificare la mancanza di cibo nel serbatoio</p></li>
</ul>
</section>
<section id="foostrumentazione-videosorveglianza" class="level3" data-number="3.3.5">
<h3 data-number="3.3.5"><span class="header-section-number">3.3.5</span> Strumentazione videosorveglianza</h3>
<p>La strumentazione deve fornire uno streaming video e audio costante nel tempo. La bidirezionalit&#xE0; &#xE8; opzionale.</p>
</section>
</section>
<section id="foorequisiti-non-funzionali" class="level2" data-number="3.4">
<h2 data-number="3.4"><span class="header-section-number">3.4</span> Requisiti non Funzionali</h2>
<p>Il primo vicolo individuato &#xE8; quello economico. Il costo del servizio, essendo l&#x2019;attivit&#xE0; non a scopo di lucro e mantenuta grazie all&#x2019;azione dei volontari, deve essere minimo. Questo &#xE8; comprensivo dell&#x2019;istallazione, dei materiali e dei costi di servizio. Un secondo vincolo rappresenta la sicurezza, l&#x2019;eventuale introduzione di strumentazione all&#x2019;interno del canile non deve rappresentare in alcun modo un pericolo per la salute dell&#x2019;animale.</p>
<p>Il sistema dovr&#xE0; rispettare alcuni requisiti non funzionali che ne determineranno la <strong>qualit&#xE0;</strong>:</p>
<section id="foodi-sistema" class="level3" data-number="3.4.1">
<h3 data-number="3.4.1"><span class="header-section-number">3.4.1</span> Di Sistema</h3>
<ul>
<li><p><strong>Reattivit&#xE0;</strong>:</p>
<ul>
<li><p>l&#x2019;utente non deve percepire <strong>ritardi</strong> nell&#x2019;ordine dei secondi tra l&#x2019;invio di un comando e l&#x2019;esecuzione dello stesso all&#x2019;interno della piattaforma.</p></li>
<li><p>le notifiche standard del sistema devono essere mostrate ai relativi utenti con un ritardo complessivo massimo non superiore al minuto.</p></li>
<li><p>le notifiche urgenti del sistema, ossia quelle relative a malfunzionamenti gravi o alla salute dell&#x2019;animale, devono essere mostrate ai relativi utenti con un ritardo complessivo massimo non superiore ai dieci secondi.</p></li>
</ul></li>
<li><p><strong>Scalabilit&#xE0;</strong>: L&#x2019;applicativo deve necessariamente consentire di aumentare o diminuire il numero di animali gestiti. Ci&#xF2; deve avvenire senza una sensibile ripercussione sulle prestazioni del sistema e un disagio minimo a livello pratico. Per prevenire, inoltre, che la presenza di una connessione cablata limiti la scalabilit&#xE0; del sistema, &#xE8; desiderabile che non ci siano altri collegamenti al di fuori dell&#x2019;alimentazione gi&#xE0; presente.</p></li>
<li><p><strong>Fault tolerance</strong>: la <strong>gestione degli errori</strong> deve essere adeguatamente implementata affinch&#xE9; le interruzioni involontarie non danneggino innanzitutto la salute degli animali. Eventuali malfunzionamenti di apparecchiature o sensoristica all&#x2019;interno del canile non devono pregiudicare il funzionamento complessivo dell&#x2019;applicativo, ma al massimo della singola unit&#xE0; logica.</p></li>
</ul>
</section>
<section id="foodella-sensoristica" class="level3" data-number="3.4.2">
<h3 data-number="3.4.2"><span class="header-section-number">3.4.2</span> Della Sensoristica</h3>
<ul>
<li><p><strong>Precisione</strong>:</p>
<ul>
<li><p><strong>Bilancia</strong> lo scostamento massimo tra pi&#xF9; misure deve essere inferiore o uguale a 10 grammi.</p></li>
<li><p><strong>Temperatura</strong> lo scostamento massimo tra pi&#xF9; misure deve essere inferiore o uguale a 2 gradi.</p></li>
<li><p><strong>Umidit&#xE0;</strong> lo scostamento massimo tra pi&#xF9; misure deve essere inferiore o uguale a 5%.</p></li>
<li><p><strong>Livello acqua</strong> lo scostamento massimo tra pi&#xF9; misure deve essere inferiore o uguale a 1 centimetro.</p></li>
<li><p><strong>Frequenza cardiaca</strong> lo scarto tra misure sulla stessa frequenza deve essere al massimo 10 battiti.</p></li>
</ul></li>
<li><p><strong>Risoluzione</strong>:</p>
<ul>
<li><p><strong>Bilancia</strong> il range di misura, partendo da vuota, deve riuscire a comprendere almeno un Kg.</p></li>
<li><p><strong>Temperatura</strong> il range deve variare tra 0 e 50 gradi.</p></li>
<li><p><strong>Umidit&#xE0;</strong> il range di umidit&#xE0; deve essere incluso tra 20-80%.</p></li>
<li><p><strong>Livello acqua</strong> Il range deve variare almeno di tre cm.</p></li>
<li><p><strong>Videocamera</strong>: necessaria almeno una risoluzione di 420p, non &#xE8; richiesta la visione notturna.</p></li>
<li><p><strong>Frequenza cardiaca</strong> la misurazione deve essere in grado di rilevare una frequenza che oscilla tra i 60 e i 160 battiti al minuto.</p></li>
<li><p><strong>Microfono</strong> deve essere in grado di determinare suoni ad elevata intensit&#xE0; compresi tra 50 e 130 dB.</p></li>
</ul></li>
<li><p><strong>Accuratezza</strong>:</p>
<ul>
<li><p><strong>Bilancia</strong> lo scostamento massimo dal valore reale deve essere inferiore o uguale a 10 grammi.</p></li>
<li><p><strong>Temperatura</strong> Lo scostamento dalla temperatura effettiva deve essere minore di 2 gradi.</p></li>
<li><p><strong>Umidit&#xE0;</strong> Si accetta un massimo di 5% accuratezza.</p></li>
<li><p><strong>Livello acqua</strong> l&#x2019;accuratezza minima deve essere di 2cm.</p></li>
<li><p><strong>Frequenza cardiaca</strong> l&#x2019;errore non deve superare i cinque battiti al minuto.</p></li>
</ul></li>
</ul>
</section>
</section>
<section id="foorequisiti-implementativi" class="level2" data-number="3.5">
<h2 data-number="3.5"><span class="header-section-number">3.5</span> Requisiti Implementativi</h2>
<p>Si definiscono i constraint a livello di implementazione che sar&#xE0; necessario rispettare nella realizzazione del progetto.</p>
<section id="foometodologie-e-tecnologie-utilizzate" class="level3" data-number="3.5.1">
<h3 data-number="3.5.1"><span class="header-section-number">3.5.1</span> Metodologie e Tecnologie Utilizzate</h3>
<p>Il software dovr&#xE0; essere realizzato utilizzando almeno in parte le tecnologie studiate durante il corso di Smart-City. Dovranno inoltre essere necessariamente applicati i principi e i paradigmi assimilati durante lo stesso. Lo scopo infatti &#xE8; quello di sviluppare software di valore sociale e importanza strategica per le amministrazioni e l&#x2019;economia locale. L&#x2019;applicazione software dovr&#xE0; essere infatti d&#x2019;ausilio alla realizzazione di servizi innovativi in contesti di citt&#xE0; digitali. E&#x2019; necessario al raggiungimento di tale scopo, l&#x2019;utilizzo di tecnologie di sensing e sistemi embedded per l&#x2019;interfacciamento con il mondo fisico. Il focus preferibilmente sar&#xE0; sulla programmazione di sistemi studiati, quali Raspberry PI e microcontrollori. A questi dovranno essere interfacciati sensori e attuatori IoT, tra i quali ve ne devono essere alcuni di complessit&#xE0; non banale. L&#x2019;utilizzo dei protocolli di comunicazione dovr&#xE0; essere adeguato all&#x2019;uso che ne verr&#xE0; fatto (MQTT). La metodologia di progettazione inoltre dovr&#xE0; favorire lo sviluppo di applicativi mobili, in grado di essere usati in contesti e con dispositivi differenti. Altre tecnologie preferibilmente utilizzabili, data la diffusione oramai pervasiva, sono Cloud Computing e Fog Computing, eventualmente con piattaforme studiate come Amazon Web Services. Per la parte interfaccia utente verranno sviluppate Dashboard ad-hoc per la visualizzazione delle informazioni ricavate dai dati trasmessi dai sensori. Infine verr&#xE0; possibilmente anche inclusa una parte di visione artificiale tramite l&#x2019;utilizzo di videocamere per lo streaming, eventualmente con una minima elaborazione per la sorveglianza.</p>
</section>
</section>
</section>
<section id="foodesign-architetturale" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Design Architetturale</h1>
<p>Dopo un intenso periodo di Domain Driven Design, si &#xE8; passati si &#xE8; proceduto alla fase di Design Architetturale, agevolata di molto da quest&#x2019;ultimo. Infatti da un confronto mirato con il cliente l&#x2019;architettura ottimale &#xE8; emersa quasi naturalmente. Lasciando spazio alla definizione dei dettagli pi&#xF9; tecnici che riportiamo in seguito.</p>
<section id="fooarchitettura-generale" class="level2" data-number="4.1">
<h2 data-number="4.1"><span class="header-section-number">4.1</span> Architettura Generale</h2>
<p>L&#x2019;architettura generale del sistema &#xE8; stata concepita in due macro aree: la parte IoT [Fig. <a href="#foofig:DesignArchitettura" data-reference-type="ref" data-reference="fig:DesignArchitettura">4.1</a>. in alto] e la parte cloud [Fig. <a href="#foofig:DesignArchitettura" data-reference-type="ref" data-reference="fig:DesignArchitettura">4.1</a>. in basso]. Le due sfruttano la connessione internet per connettersi, lo scambio di messaggi avviene attraverso il protocollo MQTT, mentre il flusso video viene passato per mezzo del protocollo RTSP.</p>
<p>Il sistema IoT risiede su una rete privata e comunica all&#x2019;esterno per mezzo di questi due protocolli. Le parti salienti sono la sensoristica che fornisce le informaioni sull&#x2019;ambiente circostante al microcontrollore, il quale le elabora e utilizza gli attuatori in base alle informazioni ricavate sia dai sensori che dal cloud.</p>
<p>La parte cloud si interfaccia per mezzo dell&#x2019;applicativo IOT Core ai sensori, i messaggi MQTT vengono elaborati da AWS Lambda e, qualora opportuno, immagazzinati come dati nel database. L&#x2019;applicativo web, hostato su AWS Amplify, si interfaccia anch&#x2019;esso con AWS Lambda, passando per Amazon API Gateway. Questo sia per recuperare i dati dal database DynamoDB e mostrare le statistiche, che per diramare il cambio dei settaggi fino ai microcontrollori. Infine, l&#x2019;applicativo si occupa anche di mostrare il flusso video proveniente dalla board per le telecamere di sorveglianza.</p>
<figure>
<img src="DrawIo/Architecture.png" id="foofig:DesignArchitettura" style="width:80.0%" alt="Design dell&#x2019;architettura generale del sistema" /><figcaption aria-hidden="true">Design dell&#x2019;architettura generale del sistema</figcaption>
</figure>
</section>
<section id="fooscelte-tecnologiche-cruciali" class="level2" data-number="4.2">
<h2 data-number="4.2"><span class="header-section-number">4.2</span> Scelte Tecnologiche Cruciali</h2>
<section id="fooaws" class="level3" data-number="4.2.1">
<h3 data-number="4.2.1"><span class="header-section-number">4.2.1</span> AWS</h3>
<p>Tra i servizi messi a disposizione da AWS vi &#xE8; anche Amazon Cognito che permette di gestire gli utenti. E&#x2019; stato valutato Amazon Cognito ma &#xE8; stato scartato perch&#xE9; gli utenti sono troppo pochi.</p>
</section>
<section id="fooprotocolli-di-comunicazione" class="level3" data-number="4.2.2">
<h3 data-number="4.2.2"><span class="header-section-number">4.2.2</span> Protocolli di comunicazione</h3>
<section id="fooscambio-messaggi" class="level4" data-number="4.2.2.1">
<h4 data-number="4.2.2.1"><span class="header-section-number">4.2.2.1</span> Scambio messaggi</h4>
<p>Come protocolli di comunicazione sono stati considerati i principali protocolli per la comunicazione IoT. Tra quelli di livello applicazione:</p>
<ul>
<li><p><strong>AMQP (Advanced Message Queuing Protocol)</strong>, protocollo che consente a un&#x2019;ampia gamma di sistemi e applicazioni di interagire, creando messaggistica standardizzata su scala industriale.</p></li>
<li><p><strong>CoAP (Constrained Application Protocol)</strong>, protocollo adatto alle limitazioni di larghezza di banda e di rete, per dispositivi con capacit&#xE0; limitata, ma prevalentemente per la connessione nelle comunicazioni da computer a computer.</p></li>
<li><p><strong>DDS (Data Distribution Service)</strong>, protocollo per comunicazioni peer-to-peer. In generale semplifica la distribuzione, incrementa l&#x2019;affidabilit&#xE0; e riduce la complessit&#xE0;.</p></li>
<li><p><strong>MQTT (Message Queue Telemetry Transport)</strong>, protocollo di messaggistica progettato per comunicazioni IoT. MQTT usa un criterio di tipo publish-subscribe ed &#xE8; ideale per dispositivi di dimensioni ridotte che richiedono efficienza a livello di larghezza di banda e uso della batteria.</p></li>
</ul>
<p>La scelta &#xE8; ricaduta su MQTT per la sua leggerezza ed efficienza, per la possibilit&#xE0; di instaurare comunicazioni bidirezionali tra molti dispositivi. Il design inoltre &#xE8; molto semplificato dalla possibilit&#xE0; di creare topic a cui iscriversi o in cui pubblicare i messaggi.</p>
</section>
<section id="foostreaming-video" class="level4" data-number="4.2.2.2">
<h4 data-number="4.2.2.2"><span class="header-section-number">4.2.2.2</span> Streaming Video</h4>
<p>Per lo streaming video sono stati considerate due opzioni: streaming attraverso RTSP e attraverso HTTP con un server e HTML5. RTSP &#xE8; di sicuro la scelta pi&#xF9; popolare perch&#xE9; adottato come protocollo dalle IP-cam e telecamere di sorveglianza. Nonostante ci&#xF2; non &#xE8; compatibile con HTTP e, non potendo fare lo stream su HTTP direttamente, non &#xE8; visualizzabile nativamente dai browser. Questo protocollo &#xE8; infatti usato internamente alle reti private. Volendo esporre il flusso video anche al di fuori della rete privata del committente la scelta &#xE8; ricaduta sulla seconda opzione. Inoltre, con questa tecnologia alla videosorveglianza si ha accesso con qualsiasi browser, da computer o da smartphone.</p>
</section>
</section>
<section id="foomicrocontrollori-e-soc" class="level3" data-number="4.2.3">
<h3 data-number="4.2.3"><span class="header-section-number">4.2.3</span> Microcontrollori e Soc</h3>
<section id="foohardware" class="level4" data-number="4.2.3.1">
<h4 data-number="4.2.3.1"><span class="header-section-number">4.2.3.1</span> Hardware</h4>
<p>Le piattaforme di sviluppo per l&#x2019;IoT tenute presente sono state molteplici, da board con potenza computazionale pi&#xF9; elevata, come Raspberry Pi, a scendere fino a ESP e le varianti Arduino.</p>
<p>Le board Arduino sono state scartate quasi subito, per la poca potenza computazionale e la necessit&#xE0; di moduli aggiuntivi per le connessioni. La board RaspBerry Pi &#xE8; stata scelta per task pi&#xF9; computazionalmente onerosi, legati alla gestione ambientale, quali la video sorveglianza e l&#x2019;analisi immagini. Questa scelta non pu&#xF2; essere invece adottata per la gestione delle gabbie. Le principali motivazioni risiedono nel fatto che il numero &#xE8; variabile e il costo supererebbe molto superiore al budget. La scelta in questo caso &#xE8; ricaduta sull&#x2019;ESP, non solo per il forte fattore cost-competitive, e per il supporto a Bluetooth e WiFi integrati, ma anche per il supporto della community e l&#x2019;ottima potenza computazionale. Inoltre, rinunciando all&#x2019;analisi immagini e alla qualit&#xE0; video a favore dei costi, il cliente potr&#xE0; anche scegliere di sostituire la board Raspberry con un pi&#xF9; economico ESP32-CAM. Con l&#x2019;ESP8266 le prime settimane il lavoro di indagine preliminare ha rilevato qualche che risultava troppo limitato per utilizzare MicroPython. Tra ESP8266 e ESP32 &#xE8; stato preferito quest&#x2019;ultimo, anche per lasciare della capacit&#xE0; di calcolo per eventuali future espansioni e richieste del committente.</p>
</section>
<section id="foolinguaggio-di-programmazione" class="level4" data-number="4.2.3.2">
<h4 data-number="4.2.3.2"><span class="header-section-number">4.2.3.2</span> Linguaggio di programmazione</h4>
<p>Per quanto riguarda l&#x2019;implementazione del codice nel microcontrollore, sono state presi in considerazione quattro scelte relative ai framework di sviluppo e ai linguaggi da adottare:</p>
<ul>
<li><p><strong>C++</strong> &#xE8; il linguaggio attualmente pi&#xF9; diffuso nell&#x2019;ambito.</p></li>
<li><p><strong>Node-RED</strong> &#xE8; un tool di programmazione flow-based basato su browser, sviluppato su NodeJs e programmabile in JavaScript.</p></li>
<li><p><strong>MicroPython</strong> &#xE8; un porting pi&#xF9; leggero del compilatore Python3, eseguibile direttamente su microcontrollori. Include le principali librerie di Python e moduli aggiuntivi per l&#x2019;accesso all&#x2019;hardware di basso livello.</p></li>
<li><p><strong>Espruino</strong> &#xE8; un interprete JavaScript open-source per microcontrollori. E&#x2019; stato progettato per unit&#xE0; con poca RAM.</p></li>
</ul>
<p>Sicuramente il pi&#xF9; performante e con pi&#xF9; librerie &#xE8; C, ma risulta anche difficilmente testabile e pone challange non indifferenti per la configurazione dei sensori e per lo sviluppo di programmi molto complessi. Node-RED, basato su Node.js, ha il pieno vantaggio del suo modello non bloccante e event-driven. MicroPython d&#x2019;altra parte offre un modello ad oggetti, testabile, sia semplice che elastico, con una buona base di librerie. Infine, Espruino, interprete JavaScript anch&#x2019;esso, di facile utilizzo e dall&#x2019;interfaccia semplificata. I fattori chiave che il team ha preso in considerazione per la scelta sono stati:</p>
<ul>
<li><p>la potenza espressiva rapportata alla chiarezza del linguaggio.</p></li>
<li><p>la testabilit&#xE0; del codice</p></li>
<li><p>il numero di librerie e la futura possibilit&#xE0; di estensione del progetto.</p></li>
</ul>
<p>Alla luce delle considerazioni fatte, si &#xE8; scelto <strong>MicroPython</strong> per lo sviluppo, il testing e l&#x2019;automatizzazione nei microcontrollori. Questo permette di allinearsi con l&#x2019;utilizzo di <strong>Pyhton</strong> per il Raspberry.</p>
</section>
</section>
</section>
<section id="foopattern-architetturali-utilizzati" class="level2" data-number="4.3">
<h2 data-number="4.3"><span class="header-section-number">4.3</span> Pattern Architetturali Utilizzati</h2>
<section id="fooclient-server" class="level3" data-number="4.3.1">
<h3 data-number="4.3.1"><span class="header-section-number">4.3.1</span> Client-Server</h3>
<p>L&#x2019;utilizzo del pattern client-server, nella videosorveglianza, ha permesso di esporre il flusso video su un server apposito e di accederci da qualunque dispositivo dotato di connessione.</p>
</section>
<section id="foopusblish-subscribe" class="level3" data-number="4.3.2">
<h3 data-number="4.3.2"><span class="header-section-number">4.3.2</span> Pusblish-Subscribe</h3>
<p>L&#x2019;utilizzo del pattern publish-subscribe, &#xE8; stata una scelta chiave per la modularit&#xE0; del sistema. La divisione in topic ha portato un maggiore ordine e una modellazione pi&#xF9; vicina al vero dominio.</p>
</section>
<section id="foomaster-slave" class="level3" data-number="4.3.3">
<h3 data-number="4.3.3"><span class="header-section-number">4.3.3</span> Master-Slave</h3>
<p>E&#x2019; stato fatto uso dell&#x2019;architettura master-slave per la gestione dei microcontrollori. Questa permette di espanderne il numero a piacimento, mandando istruzioni specifiche o generali per controllarne il comportamento.</p>
</section>
<section id="fooscheduling-cooperativo" class="level3" data-number="4.3.4">
<h3 data-number="4.3.4"><span class="header-section-number">4.3.4</span> Scheduling Cooperativo</h3>
<p>Nei sistemi embedded &#xE8; stato adottato lo scheduling cooperativo per evitare tante pitfall dello scheduling preemptive, quali l&#x2019;interruzione di un processo di misura Real Time, quale quello della chiusura della valvola dell&#x2019;acqua o la misura del battito cardiaco.</p>
</section>
<section id="foostate-machine" class="level3" data-number="4.3.5">
<h3 data-number="4.3.5"><span class="header-section-number">4.3.5</span> State Machine</h3>
<p>Per definire il comportamento dei microcontrollori in maniera chiara &#xE8; stata usata la modellazione con macchine a stati. Questa ha permesso di ridurre la probabilit&#xE0; di bug nel software e di isolare i componenti permettendo una futura espansione del comportamento.</p>
</section>
</section>
</section>
<section id="foodesign-di-dettaglio" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Design di Dettaglio</h1>
<section id="foodesign-gestione-cibo-e-acqua" class="level2" data-number="5.1">
<h2 data-number="5.1"><span class="header-section-number">5.1</span> Design Gestione Cibo e Acqua</h2>
<p>Per l&#x2019;automatizzazione e la gestione di cibo e acqua si &#xE8; partiti dalle user-stories e dal modello del dominio costruito per sviluppare l&#x2019;applicativo desiderato. Osservando i requisiti &#xE8; stato progettato il modello fisico e l&#x2019;interazione dell&#x2019;animale con esso. Si riporta di seguito il <strong>design del prototipo fisico</strong>, con i sensori e attuatori in giallo e la spiegazione del suo funzionamento [Fig. <a href="#foofig:ciboacqua" data-reference-type="ref" data-reference="fig:ciboacqua">5.1</a>]. Il design permette la modularit&#xE0; tra cibo e acqua, scegliendo all&#x2019;occorrenza solo uno dei due o entrambi.</p>
<figure>
<img src="Images/CiboAcqua.png" id="foofig:ciboacqua" style="width:100.0%" alt="Design Prototipo Cibo e Acqua (sensori e attuatori in giallo)" /><figcaption aria-hidden="true">Design Prototipo Cibo e Acqua (sensori e attuatori in giallo)</figcaption>
</figure>
<section id="fooacqua" class="level3" data-number="5.1.1">
<h3 data-number="5.1.1"><span class="header-section-number">5.1.1</span> Acqua</h3>
<p>Per far fronte alla misurazione dei consumi, &#xE8; stato innanzitutto necessario scegliere un sensore per ricavarne il <strong>livello del liquido</strong> [Fig. <a href="#foofig:ciboacqua" data-reference-type="ref" data-reference="fig:ciboacqua">5.1</a>]. Il sensore deve ritornare un valore proporzionale alla percentuale di liquido rimanente. I consumi dell&#x2019;animale a questo punto verranno inviati in cloud.</p>
<p>Per quanto riguarda l&#x2019;esigenza di riempimento dell&#x2019;acqua, inizialmente la scelta era ricaduta su due sensori che rivelassero quando il liquido &#xE8; al minimo o al massimo. In seguito questo design &#xE8; stato semplificato usando direttamente il sensore introdotto per l&#x2019;invio dei dati relativi al livello del liquido. Successivamente &#xE8; necessario che il sensore si interfacci con un&#x2019;<strong>elettrovalvola</strong> [Fig. <a href="#foofig:ciboacqua" data-reference-type="ref" data-reference="fig:ciboacqua">5.1</a>] per poter riempire la ciotola aprendo o chiudendo il flusso d&#x2019;acqua all&#x2019;occorrenza.</p>
<p>Il sistema deve essere modulare per design: qualora non si disponga del sistema idrico per poter rifornire la ciotola, devono comunque essere mandati i consumi con l&#x2019;aggiunta di una notifica se se l&#x2019;acqua sta per terminare.</p>
<section id="foomacchina-a-stati" class="level4" data-number="5.1.1.1">
<h4 data-number="5.1.1.1"><span class="header-section-number">5.1.1.1</span> Macchina a stati</h4>
<p>Il comportamento &#xE8; stato modellato come una macchina a stati [Fig. <a href="#foofig:statediagramWater" data-reference-type="ref" data-reference="fig:statediagramWater">5.2</a>]. Ci&#xF2; ha permesso di chiarire meglio le azioni del sistema a fronte di un avvenimento, il suo stato corrente e il suo comportamento generale.</p>
<p>Inizialmente il comportamento prevede il controllo del <strong>consumo di acqua</strong>, ciclicamente e a intervalli regolari viene fatta una misurazione [Fig. <a href="#foofig:statediagramWater" data-reference-type="ref" data-reference="fig:statediagramWater">5.2</a> "check water consumption"].</p>
<p>E&#x2019; stata stabilita una soglia minima di diminuzione del liquido per non incorrere in falsi positivi, dove le naturali oscillazioni del sensore potrebbero inviare consumi inesistenti. Talora questa soglia venisse superata, la <strong>percentuale</strong> di liquido consumata viene <strong>inviata</strong> in cloud, memorizzando l&#x2019;ultima percentuale inviata [Fig. <a href="#foofig:statediagramWater" data-reference-type="ref" data-reference="fig:statediagramWater">5.2</a> "send water consumption"]. Il sistema continua quindi a monitorare di nuovo il livello per ulteriori consumi.</p>
<p>Inevitabilmente il liquido nella ciotola andr&#xE0; a finire, questo evento innescher&#xE0; una transizione, dipendente dalla presenza o meno dell&#x2019;elettrovalvola. Se il sistema non prevede un rifornimento idrico il sistema passer&#xE0; allo stato di <strong>notifica di acqua esaurita</strong> [Fig. <a href="#foofig:statediagramWater" data-reference-type="ref" data-reference="fig:statediagramWater">5.2</a> "finished water notify"]. In questo stato una notifica verr&#xE0; mandata all&#x2019;addetto ai rifornimenti. Quando la ciotola verr&#xE0; ricaricata il sistema passer&#xE0; in automatico nuovamente allo stato per il controllo dei consumi. Qualora il sistema fosse dotato di elettrovalvola, la transizione innescata la aprirebbe, passando allo stato di <strong>riempimento</strong> [Fig. <a href="#foofig:statediagramWater" data-reference-type="ref" data-reference="fig:statediagramWater">5.2</a> "fill water bowl"].</p>
<p>In questo stato il livello viene controllato continuamente, per non incorrere in allagamenti indesiderati. Un meccanismo di sicurezza temporizzato infatti controlla se un determinato periodo di tempo &#xE8; passato senza che il sistema sia riuscito a riempire la ciotola con la valvola aperta. In caso affermativo il sistema va in blocco, chiudendo la valvola e passando allo stato di <strong>notifica di errore</strong> [Fig. <a href="#foofig:statediagramWater" data-reference-type="ref" data-reference="fig:statediagramWater">5.2</a> "water system error notify"]. Se il livello dell&#x2019;acqua raggiunge il parametro desiderato invece lo stato torna a essere quello iniziale di osservazione.</p>
<figure>
<img src="DrawIo/stateDiagramWater.png" id="foofig:statediagramWater" style="width:100.0%" alt="Macchina a Stati Acqua" /><figcaption aria-hidden="true">Macchina a Stati Acqua</figcaption>
</figure>
</section>
</section>
<section id="foocibo" class="level3" data-number="5.1.2">
<h3 data-number="5.1.2"><span class="header-section-number">5.1.2</span> Cibo</h3>
<p>Per far fronte all&#x2019;esigenza di monitorare i consumi di cibo dell&#x2019;animale &#xE8; stata introdotto un <strong>sensore di peso</strong> [Fig. <a href="#foofig:ciboacqua" data-reference-type="ref" data-reference="fig:ciboacqua">5.1</a>]. Il sensore deve ritornare un valore proporzionale alla quantit&#xE0; di cibo presente nella ciotola. I consumi dell&#x2019;animale verranno inviati in cloud.</p>
<p>Riguardo all&#x2019;esigenza di rifornire il cibo, la bilancia si deve interfacciare con un attuatore che si occuper&#xE0; della <strong>distribuzione del materiale</strong> [Fig. <a href="#foofig:ciboacqua" data-reference-type="ref" data-reference="fig:ciboacqua">5.1</a> attuatore di sinistra]. Il design meccanico scelto &#xE8; stato quello di un nastro trasportatore per la semplicit&#xE0; di realizzazione e l&#x2019;efficacia. Altri design presi in esame comprendevano una botola che si aprisse e chiudesse, ma presentava problemi di forza per trattenere il cibo in caduta, e la vite di Archimede, ma presentava problemi nell&#x2019;incastrarsi nel meccanismo dell&#x2019;eventuale cibo in pezzi solidi. Il design con il nastro sfrutta la gravit&#xE0; per far cadere i pezzi su di esso e, all&#x2019;attivazione, trascinarli con se permettendo ad altri di cadere. La bilancia rilever&#xE0; l&#x2019;incremento e fermer&#xE0; il sistema alla quantit&#xE0; desiderata.</p>
<p>Per evitare che l&#x2019;animale mangi il cibo durante la distribuzione, falsandone le misure, &#xE8; stato introdotto un altro <strong>attuatore bidirezionale</strong> [Fig. <a href="#foofig:ciboacqua" data-reference-type="ref" data-reference="fig:ciboacqua">5.1</a>] per estendere o ritrarre uno sportellino che ne previene l&#x2019;accesso. Per determinare quando lo sportellino arriva al massimo o al minimo della sua estensione sono stati introdotti <strong>due pulsanti</strong> [Fig. <a href="#foofig:ciboacqua" data-reference-type="ref" data-reference="fig:ciboacqua">5.1</a>] che segnalano quando fermare il movimento.</p>
<p>Infine per segnalare quando il cibo di scorta sta anch&#x2019;esso per finire sono stati introdotti un <strong>laser e un sensore luminoso</strong> [Fig. <a href="#foofig:ciboacqua" data-reference-type="ref" data-reference="fig:ciboacqua">5.1</a>] nella riserva di cibo. Se il cibo &#xE8; presente il fascio laser verr&#xE0; interrotto e il sensore non rilever&#xE0; alcuna luce. Quando il cibo durante l&#x2019;erogazione scende sotto una soglia critica, il fascio raggiunge il dispositivo di sensing e una notifica verr&#xE0; inviata all&#x2019;addetto.</p>
<p>Anche qui il sistema deve essere modulare per design: qualora non ci si voglia avvalere del sistema per rifornire la ciotola, i consumi devono comunque essere mandati in cloud con l&#x2019;aggiunta di una notifica se il cibo nella ciotola sta per terminare.</p>
<section id="foomacchina-a-stati-1" class="level4" data-number="5.1.2.1">
<h4 data-number="5.1.2.1"><span class="header-section-number">5.1.2.1</span> Macchina a stati</h4>
<p>Anche in questo caso il comportamento, data la sua complessit&#xE0;, &#xE8; stato modellato come una <strong>macchina a stati</strong> [Fig. <a href="#foofig:statediagramFood" data-reference-type="ref" data-reference="fig:statediagramFood">5.3</a>]. Il comportamento &#xE8; simile alla macchina a stati mostrata in precedenza, essendo l&#x2019;attuatore per il rifornimento del cibo paragonabile all&#x2019;elettrovalvola e la bilancia paragonabile al sensore di livello dell&#x2019;acqua.</p>
<p>Inizialmente il comportamento prevede il <strong>controllo dei consumi</strong> in maniera ciclica tramite la bilancia [Fig. <a href="#foofig:statediagramFood" data-reference-type="ref" data-reference="fig:statediagramFood">5.3</a> "check food consumption"]. Anche in questo caso talora la soglia minima venisse superata, la <strong>quantit&#xE0; consumata viene inviata</strong> in cloud [Fig. <a href="#foofig:statediagramFood" data-reference-type="ref" data-reference="fig:statediagramFood">5.3</a> "send food consumption"]. Il sistema continua quindi a monitorare di nuovo il peso per ulteriori consumi.</p>
<p>Se &#xE8; stato scelto di non usufruire della parte di rifornimento cibo, il sistema quando questo si verr&#xE0; ad esaurire, passer&#xE0; allo <strong>stato di notifica</strong> [Fig. <a href="#foofig:statediagramFood" data-reference-type="ref" data-reference="fig:statediagramFood">5.3</a> "food finished notify"]. Similmente al comportamento del sistema per l&#x2019;acqua , quando la ciotola verr&#xE0; ricaricata il sistema passer&#xE0; in automatico nuovamente allo stato per il controllo dei consumi. In caso fosse presente il sistema di ricarica cibo completo, l&#x2019;attuatore per chiudere l&#x2019;accesso al cibo si attiver&#xE0;, passando allo <strong>stato di chiusura</strong> [Fig. <a href="#foofig:statediagramFood" data-reference-type="ref" data-reference="fig:statediagramFood">5.3</a> "blocking food access"]. Una volta completata la chiusura il nastro per l&#x2019;erogazione del cibo verr&#xE0; attivato e il sistema passer&#xE0; allo <strong>stato di erogazione</strong> [Fig. <a href="#foofig:statediagramFood" data-reference-type="ref" data-reference="fig:statediagramFood">5.3</a> "fill food bowl"]. Se non fosse presente lo sportellino per l&#x2019;accesso al cibo, dallo stato iniziale si passer&#xE0; direttamente a quest&#x2019;ultimo attivando il nastro, senza il passaggio intermedio.</p>
<p>In questo stato il livello viene controllato continuamente, per un dosaggio corretto. Assieme al peso del cibo erogato, viene controllata anche la presenza del fascio laser. Qualora venisse rilevato significa che il cibo di scorta sta per finire e una notifica viene inviata all&#x2019;addetto. Anche in questo caso &#xE8; presente un meccanismo di sicurezza temporizzato che, dopo un periodo di tempo massimo, blocca l&#x2019;erogazione e <strong>passa allo stato di notifica errore</strong> di sistema [Fig. <a href="#foofig:statediagramFood" data-reference-type="ref" data-reference="fig:statediagramFood">5.3</a> "food system error notify"]</p>
<p>In caso il cibo invece raggiunga la quantit&#xE0; desiderata, il sistema torner&#xE0; allo stato iniziale, garantendo eventualmente l&#x2019;accesso al cibo tramite lo <strong>stato di apertura</strong> [Fig. <a href="#foofig:statediagramFood" data-reference-type="ref" data-reference="fig:statediagramFood">5.3</a> "allowing food access"]</p>
<figure>
<img src="DrawIo/stateDiagramFood.png" id="foofig:statediagramFood" style="width:100.0%" alt="Macchina a Stati Cibo" /><figcaption aria-hidden="true">Macchina a Stati Cibo</figcaption>
</figure>
</section>
</section>
</section>
<section id="foodesign-monitoraggio-parametri-vitali" class="level2" data-number="5.2">
<h2 data-number="5.2"><span class="header-section-number">5.2</span> Design Monitoraggio Parametri Vitali</h2>
<p>Per il monitoraggio dei parametri vitali il design fisico &#xE8; stato semplificato di molto, richiedendo due sensori e un microcontrollore. Il <strong>design del prototipo fisico</strong>, con i sensori in giallo e la spiegazione del suo funzionamento [Fig. <a href="#foofig:collare" data-reference-type="ref" data-reference="fig:collare">5.4</a>] sono riportati di seguito.</p>
<figure>
<img src="Images/collare.png" id="foofig:collare" style="width:80.0%" alt="Design Prototipo Collare" /><figcaption aria-hidden="true">Design Prototipo Collare</figcaption>
</figure>
<p>Il primo device di sensing necessario &#xE8; quello di <strong>temperatura</strong>, che periodicamente deve inviare i valori letti al cloud. Eventualmente, se i valori sono fuori norma, deve segnalarlo inviando una notifica immediatamente. Il secondo sensore &#xE8; necessariamente quello dei <strong>battiti</strong>. Anch&#x2019;esso deve inviare a intervalli regolari i battiti per minuto in cloud, affinch&#xE9; vengano registrati. Opzionalmente sar&#xE0; presente un LED per visualizzare i battiti in real-time. In caso di anomalie tali da portare i valori oltre il minimo o il massimo, una notifica deve essere mandata tempestivamente. La macchina a stati si compone semplicemente di due stati divisi che ciclano su loro stessi, inviando periodicamente i valori letti ed eventualmente le notifiche per le anomalie.</p>
</section>
<section id="foodesign-videosorveglianza" class="level2" data-number="5.3">
<h2 data-number="5.3"><span class="header-section-number">5.3</span> Design Videosorveglianza</h2>
<p>Per la videosorveglianza il design ha richiesto necessariamente, come descritto in precedenza, una board pi&#xF9; potente che sostenesse l&#x2019;elaborazione delle immagini. Di seguito il <strong>design del prototipo fisico</strong>, con i sensori in giallo e la spiegazione del suo funzionamento [Fig. <a href="#foofig:canile" data-reference-type="ref" data-reference="fig:canile">5.5</a>].</p>
<figure>
<img src="Images/Canile.png" id="foofig:canile" style="width:60.0%" alt="Design Prototipo Monitoraggio Canile (sensori in giallo)" /><figcaption aria-hidden="true">Design Prototipo Monitoraggio Canile (sensori in giallo)</figcaption>
</figure>
<p>Per quanto riguarda i sensori, ovviamente &#xE8; necessaria una <strong>videocamera</strong>, che catturi l&#x2019;ambiente circostante e mandi il flusso video alla board per un analisi. Oltre alla videocamera, opzionalmente, sono stati modellati un <strong>sensore di temperatura e umidit&#xE0;</strong>, per salvare in cloud i parametri ambientali del canile, e un <strong>device di sensing sonoro</strong>, per rilevare suoni forti continuativi. La board deve anche fornire opzionalmente lo streaming video della telecamera, facendo da server, per l&#x2019;addetto alla sorveglianza. Il flusso dei dati &#xE8; chiaramente unidirezionale, dai sensori e dalla webcam verso l&#x2019;esterno, come da architettura generale [Fig. <a href="#foofig:DesignArchitettura" data-reference-type="ref" data-reference="fig:DesignArchitettura">4.1</a>].</p>
</section>
<section id="foodesign-del-database" class="level2" data-number="5.4">
<h2 data-number="5.4"><span class="header-section-number">5.4</span> Design del Database</h2>
<p>Per immagazzinare i dati necessari all&#x2019;applicazione si &#xE8; deciso di utilizzare <strong>Dynamo DB</strong>. Il database principale doveva immagazzinare:</p>
<ul>
<li><p>I <strong>profili</strong> dei <strong>cani</strong> presenti all&#x2019;interno del canile;</p></li>
<li><p>Gli <strong>orari</strong> e le <strong>quantit&#xE0;</strong> di cibo da somministrare a seconda del cane;</p></li>
<li><p>I <strong>valori</strong> rilevati dai dispositivi di <strong>sensing</strong>, che comprendono:</p>
<ul>
<li><p>Temperatura corporea;</p></li>
<li><p>Frequenza cardiaca;</p></li>
<li><p>Consumo di acqua;</p></li>
<li><p>Consumo di cibo;</p></li>
<li><p>Temperatura ambientale del canile;</p></li>
<li><p>Umidit&#xE0; rilevata all&#x2019;interno del canile;</p></li>
</ul></li>
<li><p>I profili degli <strong>utenti</strong>.</p></li>
</ul>
<p>La progettazione del database &#xE8; stata portata a termine seguendo diversi passaggi:</p>
<ol>
<li><p>Definizione di uno schema <strong>ER</strong> da utilizzare come base di partenza;</p></li>
<li><p>Individuazione degli <strong>accessi</strong> mediante la definizione delle <strong>query</strong> principali;</p></li>
<li><p>Definizione dei <strong>pattern</strong> di Primary Key e Sort Key;</p></li>
<li><p>Introduzione di indici e campi aggiuntivi;</p></li>
</ol>
<section id="foodefinizione-di-un-er" class="level3" data-number="5.4.1">
<h3 data-number="5.4.1"><span class="header-section-number">5.4.1</span> Definizione di un ER</h3>
<p>Nonostante non si tratti di un database relazionale, abbozzare uno schema Entity Relationship pu&#xF2; essere utile per avere una buona visione di partenza di come devono essere gestiti i dati.</p>
<section id="fooinformazioni-sui-cani" class="level4" data-number="5.4.1.1">
<h4 data-number="5.4.1.1"><span class="header-section-number">5.4.1.1</span> Informazioni sui cani</h4>
<p>Il primo schema ad essere stato elaborato &#xE8; stato quello che racchiude tutto ci&#xF2; che ha a che fare con i dati di un cane, ovvero il profilo del cane, i dettagli della sua relativa distribuzione del cibo e le rilevazioni di cibo, acqua, temperatura e battiti che lo riguardano.</p>
<figure>
<img src="DrawIo/EntityRelationship.png" id="foofig:dogER" style="width:60.0%" alt="ER dati del cane" /><figcaption aria-hidden="true">ER dati del cane</figcaption>
</figure>
<ul>
<li><p><strong>Cane</strong>: il profilo del cane &#xE8; modellato mediante la tabella <code>Dog</code> che, oltre alle consuete informazioni presenta anche le soglie, impostate dal veterinario, al di fuori delle quali si rileva un&#x2019;anomalia.</p></li>
<li><p><strong>Programma dei pasti</strong>: l&#x2019;entit&#xE0; <code>Food_Schedule</code> immagazzina gli orari e le quantit&#xE0; dei pasti. Il criterio secondo cui, nel caso standard, vengono decisi questi dati &#xE8; la taglia, tuttavia si &#xE8; deciso di collegare l&#x2019;entit&#xE0; direttamente al cane poich&#xE9; ci&#xF2; permette di effettuare una programmazione pi&#xF9; a grana fine. In questo modo, infatti, si pu&#xF2; consentire ad un veterinario di effettuare modifiche sul regime alimentare di un unico cane, senza influenzare gli altri cani della stessa taglia.</p></li>
<li><p><strong>Rilevazioni</strong>: nello schema in figura &#xE8; gi&#xE0; stata collassata la gerarchia delle rilevazioni sopra elencate, concentrandole nell&#x2019;entit&#xE0; <code>Dog_log</code> che ne distingue la natura mediante il campo <code>type</code>.</p></li>
</ul>
</section>
<section id="fooinformazioni-sugli-utenti" class="level4" data-number="5.4.1.2">
<h4 data-number="5.4.1.2"><span class="header-section-number">5.4.1.2</span> Informazioni sugli utenti</h4>
<p>In fase di progettazione si voleva che il database gestisse anche gli utenti che agiscono sul sito, in maniera tale che ne fossero definiti i ruoli in base ai quali avrebbero avuto diversi permessi e una diversa visualizzazione dei dati sul sito web. Questo ER si distacca da quello relativo ai cani e si presenta in questo modo:</p>
<figure>
<img src="DrawIo/UserER.png" id="foofig:userER" style="width:60.0%" alt="ER utenti" /><figcaption aria-hidden="true">ER utenti</figcaption>
</figure>
</section>
<section id="foorilevazioni-ambientali" class="level4" data-number="5.4.1.3">
<h4 data-number="5.4.1.3"><span class="header-section-number">5.4.1.3</span> Rilevazioni ambientali</h4>
<p>Anche per quanto riguarda le rilevazioni ambientali ci si trova di fronte a un&#x2019;area separata dalle precedenti, perch&#xE9; non ha alcun tipo di correlazione n&#xE9; con i cani, n&#xE9; con gli utenti. Esse sono modellate con una tabella di nome <code>Env_Logs</code> che ne immagazzina il <code>timestamp</code>, il <code>type</code>, che serve a distinguere le rilevazioni di temperatura e quelle di umidit&#xE0; e il <code>value</code> che, nel caso della temperatura &#xE8; espresso in gradi mentre nel caso dell&#x2019;umidit&#xE0; &#xE8; espresso in percentuale.</p>
</section>
</section>
<section id="fooindividuazione-degli-accessi" class="level3" data-number="5.4.2">
<h3 data-number="5.4.2"><span class="header-section-number">5.4.2</span> Individuazione degli accessi</h3>
<p>Una volta ottenuta una bozza dello schema Entity Relationship si &#xE8; passati a definire gli accessi in base alle query che sar&#xE0; necessario chiamare per interrogare il database. Definire gli accessi si rivela essere di vitale importanza quando si lavora con un database come DynamoDB perch&#xE9; permette di impostare le tabelle in modo da rendere pi&#xF9; facile l&#x2019;accesso ai dati pi&#xF9; richiesti. Per permettere ci&#xF2; si &#xE8; portati anche a introdurre delle ridondanze e a sacrificare l&#x2019;integrit&#xE0; referenziale prediligendo i benefici sulle performance. Di seguito le interrogazioni suddivise per frequenza</p>
<ul>
<li><p><strong>Frequenza molto elevata</strong> (ogni pochi minuti)</p>
<ul>
<li><p>inserimento di una rilevazione riguardante consumi, parametri vitali del cane, valori ambientali</p></li>
</ul></li>
<li><p><strong>Frequenza elevata</strong> (poche volte all&#x2019;ora)</p>
<ul>
<li><p>visualizzazione dei cani presenti</p></li>
<li><p>visualizzazione dei consumi di un cane</p></li>
<li><p>visualizzazione dell&#x2019;ultima rilevazione di temperatura e battiti di un cane</p></li>
</ul></li>
<li><p><strong>Frequenza media</strong> (una o poche volte al giorno)</p>
<ul>
<li><p>visualizzazione storico delle rilevazioni di un cane</p></li>
<li><p>visualizzazione dei consumi di un cane</p></li>
<li><p>inserimento di un nuovo cane</p></li>
<li><p>interrogazione sull&#x2019;orario e la quantit&#xE0; dei pasti</p></li>
<li><p>a fine giornata, comparazione dei consumi totali di acqua e cibo odierni, per ciascun cane, con i rispettivi range giornalieri contenuti nel profilo dell&#x2019;animale.</p></li>
</ul></li>
<li><p><strong>Frequenza bassa</strong> (meno di una volta a settimana)</p>
<ul>
<li><p>impostazione delle soglie dei consumi di un cane oltre le quali vi &#xE8; un&#x2019;anomalia</p></li>
<li><p>impostazione delle soglie dei parametri vitali di un cane oltre le quali vi &#xE8; un&#x2019;anomalia</p></li>
<li><p>aggiornamento del programma dei pasti</p></li>
<li><p>aggiornamento dello stato di un cane</p></li>
</ul></li>
</ul>
</section>
<section id="foodefinizione-dei-pattern-di-primary-key-e-sort-key" class="level3" data-number="5.4.3">
<h3 data-number="5.4.3"><span class="header-section-number">5.4.3</span> Definizione dei pattern di Primary Key e Sort Key</h3>
<p>Dopo aver individuato le interrogazioni che verranno fatte sul database e le loro frequenze si &#xE8; passati alla progettazione vera e propria dell&#x2019;<strong>unica tabella</strong> del database. A differenza di un database relazionale, infatti, DynamoDB non permette di ricorrere alle <strong>join</strong>, se non con dei workaround la quale adozione &#xE8; un chiaro sintomo del fatto che non si &#xE8; scelta correttamente la tipologia di database da adottare. La tabella che &#xE8; stata creata &#xE8; strutturata con i seguenti campi:</p>
<ul>
<li><p><strong>PK</strong>: o Primary Key, &#xE8; la chiave primaria e consiste in una stringa che determiner&#xE0; la natura del record a cui appartiene.</p></li>
<li><p><strong>SK</strong>: o Sort Key, &#xE8; la chiave di ordinamento e consiste anch&#x2019;essa in una stringa che segue uno specifico pattern e che assieme alla PK determiner&#xE0; univocamente il record.</p></li>
<li><p><strong>Altri campi</strong>: che sono dati dall&#x2019;unione dei campi di tutte le entit&#xE0; che si &#xE8; deciso di coinvolgere, con l&#x2019;aggiunta di alcuni campi introdotti per fornire un&#x2019;indicizzazione o per inserire delle ridondanze che facilitino l&#x2019;accesso.</p>
<p>I pattern che sono stati definiti per PK e SK sono i seguenti:</p>
<figure>
<img src="DrawIo/KeysPattern.png" id="foofig:KeyPattern" style="width:60.0%" alt="Pattern PK e SK suddivisi per entit&#xE0; di riferimento" /><figcaption aria-hidden="true">Pattern PK e SK suddivisi per entit&#xE0; di riferimento</figcaption>
</figure></li>
</ul>
<p>Dalla tabella, oltre ai pattern per i valori delle chiavi &#xE8; possibile anche intuire il modo in cui si &#xE8; deciso di effettuare la trasposizione dallo schema relazionale. Si pu&#xF2; notare infatti che:</p>
<ul>
<li><p><strong><code>Food_Schedule</code></strong>: si &#xE8; deciso di mantenere la programmazione dei pasti separata dai dati del cane poich&#xE9; mantenerla come struttura dati all&#x2019;interno del profilo avrebbe reso meno immediata la modifica e il recupero degli orari e delle quantit&#xE0; che il sistema automatizzato deve erogare.</p></li>
<li><p><strong><code>Dog_Log</code></strong>: la stessa decisione &#xE8; stata presa per quanto riguarda i dati delle rilevazioni, poich&#xE9; la query che permette l&#x2019;inserimento di questi dati &#xE8; quella che verr&#xE0; chiamata con la massima frequenza ed era quindi importante facilitarne la fruizione.</p></li>
<li><p><code>User</code>: una sorte diversa &#xE8; spettata ai ruoli ricoperti dagli utenti. Si &#xE8; deciso di modellare i ruoli come una set di stringhe all&#x2019;interno del profilo dell&#x2019;utente, poich&#xE9; si tratterebbe di un campo che viene modificato raramente.</p></li>
</ul>
</section>
<section id="foointroduzione-di-indici-e-campi-aggiuntivi" class="level3" data-number="5.4.4">
<h3 data-number="5.4.4"><span class="header-section-number">5.4.4</span> Introduzione di indici e campi aggiuntivi</h3>
<p>L&#x2019;ultima fase &#xE8; stata quella di individuare quali altre modifiche potevano essere apportate al risultato finale della tabella per favorire le interrogazioni. Si &#xE8; deciso pertanto di:</p>
<ul>
<li><p>aggiungere i <strong>campi</strong> <code>last_temp</code> e <code>last_hb</code> nel profilo del cane per permettere una pi&#xF9; prestante interrogazione nel momento in cui, nella homepage del sito si vogliono visualizzare le ultime rilevazioni dei parametri vitali del cane. In assenza di questi due campi sarebbe stato necessario interrogare il database con un range di timestamp sensato per ottenere una fetta dello storico delle rilevazioni, ordinarle e restituire la pi&#xF9; recente. Questo per la temperatura che per la frequenza cardiaca.</p></li>
<li><p>aggiungere un nuovo <strong>indice</strong> sul campo <strong><code>size</code></strong> per permettere di effettuare alcune query basandosi sulla taglia del cane.</p></li>
</ul>
</section>
</section>
<section id="foodesign-webapp" class="level2" data-number="5.5">
<h2 data-number="5.5"><span class="header-section-number">5.5</span> Design WebApp</h2>
<p>La WebApp &#xE8; stata suddivisa in due <strong>Macro</strong> aree:</p>
<ul>
<li><p><strong>Login</strong>: la schermata si occupa di fornire un accesso base all&#x2019;utente, l&#x2019;unica funzione esposta &#xE8; la possibilit&#xE0; di effettuare il <strong>login</strong>, attualmente rappresenta un placeholder, dato che non contine alcuna logica n&#xE9; funzione utile, questo per concentrarsi maggiormente su aspetti pi&#xF9; inerenti.</p></li>
<li><p><strong>Home</strong>: fornisce tutte le funzioni principali dell&#x2019;applicativo, la schermata &#xE8; divisa in schede, ogni scheda &#xE8; a sua volta divisa in pi&#xF9; componenti, uno per la visualizzazione dei cani presenti e uno per le azioni specifiche da attuare su di esso, o in generale. L&#x2019;unica scheda che contiene un solo</p>
<p>dove ogni scheda consente determinate operazioni:</p>
<ul>
<li><p><strong>Gestore</strong>: Consente di effettuare le principali azioni del sito, inoltre pu&#xF2; anche effettuare le azioni seguenti.</p></li>
<li><p><strong>Addetto alla salute</strong>: Pu&#xF2; visualizzare i parametri vitali e lo stato di salute degli animali.</p></li>
<li><p><strong>Addetto ai rifornimenti</strong>: Pu&#xF2; visualizzare i dati di un cane, i suoi consumi e impostare l&#x2019;orario e la quantit&#xE0; di cibo.</p></li>
<li><p><strong>Addetto alla sorveglianza</strong>: Pu&#xF9; visualizzare lo streaming video.</p></li>
<li><p><strong>Altro addetto</strong>: placeholder per funzioni future</p></li>
</ul></li>
</ul>
</section>
<section id="foodesign-serverless-application" class="level2" data-number="5.6">
<h2 data-number="5.6"><span class="header-section-number">5.6</span> Design Serverless Application</h2>
<p>L&#x2019;esposizione delle funzioni del back-end, segue a braccetto la definizione delle query necessarie per interrogare e inserire nuovi dati all&#x2019;interno di DynamoDB.</p>
<p>Le funzioni sono state divise per innesco, dove abbiamo:</p>
<ul>
<li><p>Lambda ad innesco <strong>API REST</strong>: rappresentano la maggioranza delle funzioni, sono ulteriormente divise in base allo scopo di interrogazione(GET) o inserimento(POST)</p></li>
<li><p>Lambda ad innesco <strong>Crono</strong>: i consumi dei cani sono controllati a fine giornata per verificare che le soglie dei consumi siano nei parametri. l&#x2019;innesco avviene tramite eventi <strong>CloudWatch</strong></p></li>
<li><p>Lambda ad innesco <strong>MQTT</strong>: rappresentano i diretti inserimenti delle rilevazioni all&#x2019;interno del database, sono in ascolto su un sul topic <strong>ESP/#</strong>, questo consente di ascoltare tutti i messaggi provenienti da i sotto topic.</p></li>
</ul>
</section>
</section>
<section id="fooimplementazione" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Implementazione</h1>
<section id="foosoftware-microcontrollori" class="level2" data-number="6.1">
<h2 data-number="6.1"><span class="header-section-number">6.1</span> Software Microcontrollori</h2>
<section id="fooclasse-principale" class="level5" data-number="6.1.0.0.1">
<h5 data-number="6.1.0.0.1"><span class="header-section-number">6.1.0.0.1</span> Classe principale</h5>
<p>Come spiegato nel capitolo Scelte tecnologiche cruciali, i microcontrollori sono stati programmati in <strong>MicroPython</strong>. Nella classe principale, condivisa e riutilizzabile tra tutti i microcontrollori, dopo la connessione a internet e al broker MQTT &#xE8; stato creato uno <strong>scheduler</strong>. Questo si occupa di eseguire i <strong>task a lui assegnati</strong>, siano relativi al cibo, all&#x2019;acqua, o ai parametri vitali. In questo modo &#xE8; facilmente programmabile il comportamento di un microcontrollore con task modulari.</p>
<pre><code>        # array of tasks
        print(&quot;Creating array of tasks&quot;)
        tasks = [smart_collar_temperature_task.get_behaviour(), smart_collar_heartbeat_task.get_behaviour()]  # array of coroutines
        
        # create the scheduler and start tasks
        print(&quot;--- Starting Scheduler ---&quot;)
        scheduler = Scheduler()
        scheduler.start(tasks)</code></pre>
</section>
<section id="fooclassi-per-sensori-e-attuatori" class="level5" data-number="6.1.0.0.2">
<h5 data-number="6.1.0.0.2"><span class="header-section-number">6.1.0.0.2</span> Classi per sensori e attuatori</h5>
<p>Avendo adottato MicroPython &#xE8; stato possibile usufruire del linguaggio ad oggetti per modellare attuatori e sensori come classi, con propriet&#xE0; chiamabili all&#x2019;occorrenza. Ogni classe &#xE8; stata testata individualmente grazie ai test scritti appositamente per prevenire comportamenti indesiderati. Si pu&#xF2; trovare il diagramma delle classi di ogni device con cui si interfaccia il microcontrollore in [Fig. <a href="#foofig:classdiagram" data-reference-type="ref" data-reference="fig:classdiagram">6.1</a>].</p>
<figure>
<img src="DrawIo/ClassDiagram.png" id="foofig:classdiagram" style="width:80.0%" alt="Diagramma delle classi" /><figcaption aria-hidden="true">Diagramma delle classi</figcaption>
</figure>
<p>In particolare, ogni device di sensing, &#xE8; stato modellato ereditando dalla classe Sensor, che mette a disposizione una serie di metodi per poter calcolare la media pesata, la percentuale misurata nel range minimo e massimo e l&#x2019;ultima misurazione. La media &#xE8; pesata &#xE8; calcolata esponenzialmente in base alle ultime misure, le quali hanno peso maggiore:</p>
<pre><code>    def measure(self):
        &quot;&quot;&quot;measures 3 times, measure is the mean of them, updates global average, returns measure.&quot;&quot;&quot;
        sum_raw_measures = 0
        for _ in range(3):
            sum_raw_measures += self.raw_measure()
        self.last_measure = sum_raw_measures / 3
        # average calculated from last average, weighted and actual measure, weighted
        self.average = self.last_measure * self.average_converging_speed +                           self.average * ( 1 - self.average_converging_speed)
        return self.last_measure</code></pre>
</section>
<section id="foogestione-cibo-e-acqua" class="level3" data-number="6.1.1">
<h3 data-number="6.1.1"><span class="header-section-number">6.1.1</span> Gestione Cibo e Acqua</h3>
<section id="foocibo-1" class="level4" data-number="6.1.1.1">
<h4 data-number="6.1.1.1"><span class="header-section-number">6.1.1.1</span> Cibo</h4>
<p>L&#x2019;implementazione del task relativo alla gestione del cibo da passare allo scheduler &#xE8; stato implementato in una classe dedicata. Il comportamento che il task espone rispecchia la macchina a stati discussa nel design [Fig. <a href="#foofig:statediagramFood" data-reference-type="ref" data-reference="fig:statediagramFood">5.3</a>]. Grazie alla possibilit&#xE0; di Python di avere funzioni higher-order, il loop principale esegue ciclicamente lo stato corrente:</p>
<pre><code>        async def get_behaviour(self):
        &quot;&quot;&quot;async method called returns a coroutine&quot;&quot;&quot;
            while True:
                # executes the current state
                await self.state()</code></pre>
<p>Quando il task &#xE8; creato, nel costruttore &#xE8; possibile scegliere lo stato iniziale assegnando la funzione relativa allo stato corrente.</p>
<pre><code>        # state variable holds the current state, this is the initial state
        self.state = self.check_food_consumption</code></pre>
<p>All&#x2019;interno di ogni stato vengono effettuate le operazioni necessarie e, qualora le condizioni si verifichino, le transizioni a un nuovo stato.</p>
<pre><code>        # check consumption
        self.reduction_percentage = self.previous_sent_perc - self.scale.get_percentage()
        print(&quot;\t\tReduction Percentage: {:.2f}&quot;.format(self.reduction_percentage))
        if self.reduction_percentage &gt;= PERCENTAGE_CONSUMPTION_THRESHOLD:
            self.state = self.send_food_consumption
            return</code></pre>
<p>Particolarmente impegnativa &#xE8; stata la modellazione della bilancia. Questa va tarata inizialmente affinch&#xE9; il peso della ciotola vuota non vada ad influire sul peso del cibo. Inoltre parecchie prove sono state effettuate per trovare il coefficiente di conversione tra i valori del sensore e il peso in grammi. Infine la gestione del motore bidirezionale per aprire e chiudere lo sportellino di accesso al cibo ha anch&#x2019;esso richiesto parecchia cura, dovendo implementare una classe che si preoccupasse di invertire la polarit&#xE0; al motore attraverso un ponte-H e la logica di interruzione del movimento al momento giusto.</p>
</section>
<section id="fooacqua-1" class="level4" data-number="6.1.1.2">
<h4 data-number="6.1.1.2"><span class="header-section-number">6.1.1.2</span> Acqua</h4>
<p>Il task relativo alla gestione della ciotola dell&#x2019;acqua &#xE8; stato implementato, similmente a quello del cibo, in una classe apposita, per poter essere passato allo scheduler. Essendo i task pi&#xF9; di uno, a questo punto &#xE8; sorto naturale implementare una classe task da cui tutti quelli descritti nel seguente capitolo erediteranno. La logica a stati del design &#xE8; stata implementata rispecchiandolo a pieno. Ci&#xF2; perch&#xE9; la precedente modellazione dei sensori ha agevolato di parecchio la scrittura del codice, rendendolo pulito e facilmente comprensibile.</p>
<pre><code>        # measure
        self.waterSensor.measure()
        print(&quot;\t\t\tWater Measure:  {:.2f}&quot;.format(self.waterSensor.get_percentage()))
        # check empty
        if self.waterSensor.get_percentage() &lt; self.min_water_lvl_perc:
            print(&quot;\t\t\tWater LOW: {:.2f} &lt; {:.2f}&quot;.format(self.waterSensor.get_percentage(), self.min_water_lvl_perc))
            if self.valve_present:
                print(&quot;\t\t\tOpening Valve&quot;)
                self.valve.open()
                self.state = self.fill_water_bowl
                return</code></pre>
<p>In questo caso il sensore dell&#x2019;acqua &#xE8; stato ampliato con delle funzioni per il ritorno della percentuale. Non &#xE8; possibile infatti dedurre il quantitativo bevuto da un&#x2019;animale semplicemente dal sensore, poich&#xE9; il range di questo &#xE8; proporzionale all&#x2019;altezza del liquido nel contenitore, ma non &#xE8; dato sapere la sua capienza. Per questo motivo il parametro capienza massima pu&#xF2; essere passato al dispositivo di sensing. Grazie a questo dato verr&#xE0; calcolata la quantit&#xE0; di acqua bevuta al diminuire della percentuale rilevata dal sensore.</p>
<section id="foocomunicazioni" class="level5" data-number="6.1.1.2.1">
<h5 data-number="6.1.1.2.1"><span class="header-section-number">6.1.1.2.1</span> Comunicazioni</h5>
<p>Entrambi i task di cibo e acqua adottano il protocollo MQTT per comunicare con il cloud. Lo scambio &#xE8; bidirezionale ed &#xE8; gestito dalla classe "MQTTManager". Questa si occupa dell&#x2019;invio dei messaggi e, qualora il task "MQTTMessageChecker" sia in esecuzione, di ricevere i messaggi dal server. Questi messaggi innescheranno la gestione delle callback passando allo scheduler un task "MQTTMessageHandler". I messaggi sono scambiati in formato JSON. Ogni unit&#xE0; di controllo gabbia inizialmente si identifica mandando un messaggio al broker. In seguito vengono iniziate le rilevazioni per i consumi e, in caso di necessit&#xE0;, un messaggio affinch&#xE9; il server invii la notifica all&#x2019;addetto.</p>
<figure>
<img src="DrawIo/sequenceWaterAutomation.png" id="foofig:sequencewater" style="width:80.0%" alt="Sequenza scambio dei messaggi del sistema acqua" /><figcaption aria-hidden="true">Sequenza scambio dei messaggi del sistema acqua</figcaption>
</figure>
</section>
</section>
</section>
<section id="foomonitoraggio-parametri-vitali" class="level3" data-number="6.1.2">
<h3 data-number="6.1.2"><span class="header-section-number">6.1.2</span> Monitoraggio Parametri Vitali</h3>
<section id="footemperatura" class="level4" data-number="6.1.2.1">
<h4 data-number="6.1.2.1"><span class="header-section-number">6.1.2.1</span> Temperatura</h4>
<p>Il task relativo al monitoraggio della temperatura nel collare &#xE8; stato sviluppato affinch&#xE9; possa essere usato con due sensori diversi: il ds18x20 e il dht11. Creando il task si pu&#xF2; scegliere il modello posseduto e, quando lo scheduler inizier&#xE0; a eseguire ciclicamente le misurazioni, i dati e le notifiche verranno inviati in cloud.</p>
<pre><code>        # measure temp
        if self.using_ds18x20:
            temp = self.check_ds18x20()
        else:
            temp = self.check_dht()
        # send data
        self.mqtt_manager.send_msg(self.topic, &quot;Temperature: {}&quot;.format(temp))</code></pre>
</section>
<section id="foobattito-cardiaco" class="level4" data-number="6.1.2.2">
<h4 data-number="6.1.2.2"><span class="header-section-number">6.1.2.2</span> Battito Cardiaco</h4>
<p>Il task relativo al battito cardiaco svolge, come il precedente, delle misurazioni cicliche e invia i dati rilevati. Un parte particolarmente complessa &#xE8; stata quella della gestione del sensore per il battito. Il sensore, qualora interpellato, fornisce un singolo valore direttamente proporzionale alla dilatazione dei vasi sanguigni. Ne deriva la necessit&#xE0; di attuare misurazioni frequenti per non incorrere nella perdita della breve variazione di un battito. Abbiamo stabilito la frequenza di campionamento in base a quanto segue: Considerando che in condizioni di riposo, i battiti per minuto di un cane - da intendersi come pulsazioni - sono generalmente compresi tra 60 e 140 bpm, in base alla taglia, et&#xE0; e razza, e il valore pu&#xF2; raggiungere valori anche pi&#xF9; alti qualora in movimento, abbiamo preso come valore limite da rilevare 150 bpm. Ci&#xF2;, significa che il tempo di ogni ciclo cardiaco <span class="math inline">\(T_{cc}\)</span> &#xE8;: <span class="math display">\[T_{cc} = \frac{1}{bps} = \frac{1}{\frac{bpm}{60}}= \frac{60}{bpm} \Rightarrow \frac{60}{150 bpm} = 0.4s\]</span> Considerato che il ciclo cardiaco si compone in sistole (contrazione) e diastole (rilassamento), la fase sistolica &#xE8; quella pi&#xF9; facilmente rilevabile poich&#xE9; la contrazione ventricolare causata &#xE8; pi&#xF9; violenta e breve. Questa fase durante le rilevazioni effettuate dura circa un mezzo del ciclo cardiaco e produce un picco nei valori particolarmente indicativo per rilevare il battito in mezzo al naturale rumore del sensore. Per non perdere il picco massimo il numero di campionamenti <span class="math inline">\(N_{c}\)</span> durante questa fase &#xE8; stato fissato a 20. La frequenza di campionamento minima risultante <span class="math inline">\(f_{min}\)</span> &#xE8; stata calcolata come: <span class="math display">\[f_{min} = \frac{ \frac{1}{2} *  T_{cc} }{N_{c}} \Rightarrow  \frac{ \frac{1}{2} *  0.4s }{20} = 0.01s = 10 ms\]</span></p>
<p>Salvando i valori risultanti e graficandoli con la libreria python "Mathplotlib" si ottiene una linea come quella di colore rosso in [Fig. <a href="#foofig:Heartbeat" data-reference-type="ref" data-reference="fig:Heartbeat">6.3</a>]. Si pu&#xF2; notare che il campionamento &#xE8; sufficiente e permette di distinguere intuitivamente i battiti. Per rilevare le pulsazioni a livello digitale per&#xF2; &#xE8; necessario formalizzare un altro modello matematico che non faccia incorrere il sistema in falsi positivi o falsi negativi. Un primo approccio si &#xE8; basato su stabilire una singola soglia, oltre la quale il battito &#xE8; rilevato e registrato. Questa soluzione si &#xE8; rivelata inadatta in quanto il disturbo del sensore la farebbe attraversare pi&#xF9; volte (si veda in [Fig. <a href="#foofig:Heartbeat" data-reference-type="ref" data-reference="fig:Heartbeat">6.3</a>] poco prima del campionamento numero 2400 il valore attraversa la linea azzurra parecchie volte). Inadatti si sono rivelati anche i tentativi di normalizzare la linea dei valori, in quanto parecchio discontinui e di frequenza elevata, si perde la differenziazione dei picchi. Si &#xE8; optato per stabilire una doppia soglia, la prima, pi&#xF9; alta, oltre la quale il battito &#xE8; rilevato, la seconda, pi&#xF9; bassa, che determina la fine del battito. La prima volta che il valore attraversa la prima [Fig. <a href="#foofig:Heartbeat" data-reference-type="ref" data-reference="fig:Heartbeat">6.3</a>, linea azzurra] una variabile registra il battito e nessun altra registrazione viene effettuata sino a che i valori non scendono sotto la soglia di fine battito [Fig. <a href="#foofig:Heartbeat" data-reference-type="ref" data-reference="fig:Heartbeat">6.3</a>, linea gialla]. Queste soglie non possono essere fisse, variando la pressione di animale in animale e pure di giorno in giorno per lo stesso essere vivente. Per questo motivo i valori sono stati fissati per la prima a 4/5 e per la seconda a 1/2 tra minimo [Fig. <a href="#foofig:Heartbeat" data-reference-type="ref" data-reference="fig:Heartbeat">6.3</a>, linea verde] e massimo [Fig. <a href="#foofig:Heartbeat" data-reference-type="ref" data-reference="fig:Heartbeat">6.3</a>, linea blu] dei precedenti valori. La grandezza della finestra dei valori da cui prendere minimo e massimo &#xE8; stata fissata a 250 valori. Questo perch&#xE9;, come si pu&#xF2; notare dal grafico, comprende almeno due battiti. Un range troppo piccolo creerebbe dei minimi e massimi locali, rilevando picchi non propri e dando parecchi falsi positivi. Una finestra troppo ampia porterebbe a una staticit&#xE0; delle soglie rispetto alla variazione di pressione che creerebbe falsi negativi.</p>
<figure>
<img src="Images/heartbeatGraph.png" id="foofig:Heartbeat" style="width:100.0%" alt="Grafico Battiti" /><figcaption aria-hidden="true">Grafico Battiti</figcaption>
</figure>
<pre><code>       val = self.pulse_sensor.raw_measure()
        self.history.append(val)  # add to history of values
        # crop to MAX_HISTORY length, getting the tail (last ones)
        self.history = self.history[-MAX_HISTORY:]
        # get min max in the history
        minima, maxima = min(self.history), max(self.history)
        # get thresholds
        threshold_on = (minima + maxima * 4) // 5  # 4/5
        threshold_off = (minima + maxima) // 2  # 1/2
        # if val goes above beat threshold and no beat has previously been detected.
        if val &gt; threshold_on and self.still_beat == False:
            # beat detected
            self.led.on()
            self.still_beat = True  # prevents multiple appends for all the measures during a beat
            # once every beat
            self.beats.append(time.time())</code></pre>
<p>Una volta rilevati i singoli battiti con il modello matematico, il calcolo del battiti al minuto &#xE8; stato realizzato salvando la cronologia degli istanti di tempo per gli ultimi N battiti <span class="math inline">\(N_{beats}\)</span>. Sperimentalmente si &#xE8; optato per 30 registrazioni per mantenere il valore dei bpm reattivo ma non dipendente solo da poche unit&#xE0;. Prelevando dalla cronologia il tempo passato <span class="math inline">\(T_{diff}\)</span> per questi battiti, si pu&#xF2; facilmente derivare il rateo di <span class="math inline">\(bpm\)</span> attuale tramite la formula: <span class="math display">\[bpm = \frac{ N_{beats}*60 s/min }{T_{diff}} = \frac{ N_{beats}*60 s/min }{T_{last}-T_{first}}\]</span> Il battito cardiaco risultante viene poi inviato periodicamente al Database e, qualora ci fossero anomalie, una notifica viene invece generata e inviata immediatamente.</p>
<pre><code>        # calculate bpm
        beats_time = self.beats[-1] - self.beats[0]  # time difference between end and start of the queue
        if beats_time:
            bpm = (len(self.beats) / beats_time) * 60
            print(&quot;HeartBeat: {}&quot;.format(bpm))
            # if outside range
            if bpm &lt; self.min_heartbeat or bpm &gt; self.max_heartbeat:
                # send notification now
                self.mqtt_manager.send_msg(MQTT_NOTIFY_TOPIC, ujson.dumps({&quot;Notify&quot;:&quot;Heartbeat is abnormal: {}&quot;.format(bpm)}))</code></pre>
<section id="foocomunicazioni-1" class="level5" data-number="6.1.2.2.1">
<h5 data-number="6.1.2.2.1"><span class="header-section-number">6.1.2.2.1</span> Comunicazioni</h5>
<p>I task di temperatura e battiti adottano anch&#x2019;essi il protocollo MQTT per comunicare con il cloud. Lo scambio &#xE8; bidirezionale per via della necessit&#xE0; di settare i range di temperatura e battiti per le notifiche di anomalia. Ogni unit&#xE0; collare inizialmente si identifica mandando un messaggio al broker. Successivamente partono le rilevazioni per i battiti e la temperatura. I parametri vitali vengono periodicamente inviati al server assieme ai messaggi per le notifiche di anomalie.</p>
<figure>
<img src="DrawIo/sequenceSmartCollar.png" id="foofig:sequencesmartcollar" style="width:80.0%" alt="Sequenza scambio dei messaggi del sistema collare" /><figcaption aria-hidden="true">Sequenza scambio dei messaggi del sistema collare</figcaption>
</figure>
</section>
</section>
</section>
</section>
<section id="foosoftware-videosorveglianza" class="level2" data-number="6.2">
<h2 data-number="6.2"><span class="header-section-number">6.2</span> Software Videosorveglianza</h2>
<p>Il Raspberry &#xE8; stato scelto come board per la computazione delle immagini di video-sorveglianza. Il principale concorrente a questa scelta, l&#x2019;ESP32-CAM &#xE8; stato testato per lo streaming video ma non &#xE8; provvisto delle risorse computazionali necessarie per il rilevamento di anomalie. Ciononostante, avendo un costo inferiore rispetto al Raspberry &#xE8; stato comunque considerato come alternativa low-cost. Il linguaggio scelto per la programmazione &#xE8; stato <strong>Python</strong> per continuit&#xE0; con i microcontrollori e per la flessibilit&#xE0; di utilizzo. Sono state programmate multiple classi per di complessit&#xE0; crescente per agevolare l&#x2019;utilizzo del software in caso di errori. La prima classe "camera tester" ha infatti semplicemente il ruolo di testare lo stream con ffmpeg e OpenCV. Un&#x2019;altra classe "mqtt tester" si occupa di un semplice test di invio e ricezione attraverso il pacchetto mqtt di "awsiotsdk". Infine l&#x2019;ultima classe di test "stream base" si occupa di testare lo stream attraverso l&#x2019;utilizzo del pacchetto "flask" per creare un webserver su cui verr&#xE0; pubblicato il video feed.</p>
<section id="foocomunicazione" class="level5" data-number="6.2.0.0.1">
<h5 data-number="6.2.0.0.1"><span class="header-section-number">6.2.0.0.1</span> Comunicazione</h5>
<p>La parte di comunicazione &#xE8; stata gestita creando una classe MQTT apposita che permette di connettersi, disconnettersi, mandare dei messaggi e impostare le callback. Questa classe viene usata da tutte le classi successive per le comunicazioni. Infine, per passare lo stream video da un dispositivo ad un altro nella stessa rete, sono state incluse due classe "sender udp" e "receiver udp" atte allo scopo.</p>
</section>
<section id="foomotion-detection" class="level3" data-number="6.2.1">
<h3 data-number="6.2.1"><span class="header-section-number">6.2.1</span> Motion Detection</h3>
<p>Una delle due implementazioni proposte per il rilevamento di anomalie utilizza la motion detection. Questa tecnica si basa sul rilevare i cambiamenti dell&#x2019;immagine corrente dato uno sfondo di riferimento. Il motion detector base &#xE8; stato costruito come segue: Viene preso il frame corrente e viene sfumato con un filtro gaussiano per rimuovere minime differenze. Il risultato viene sottratto al frame di riferimento per il background. Nel nostro caso il frame di riferimento per il background viene aggiornato periodicamente. L&#x2019;immagine che contiene le differenze viene passata attraverso una soglia per rilevare le zone con cambiamenti sostanziali e non minimi. Viene applicata la dilatazione per unire le zone discontinue in modo tale da unire aree vicine di cambiamento. Viene calcolata l&#x2019;area delle zone di differenza e vengono scelte solo le zone con un&#x2019;area maggiore di una soglia. Le zone scelte sono zone effettive di cambiamento dell&#x2019;immagine.</p>
<pre><code>    # blur
    gray_frame = cv2.GaussianBlur(gray_frame, (21, 21), 0)
    # compute the absolute difference between the current frame and reference frame
    frameDelta = cv2.absdiff(referenceFrame, gray_frame)
    thresh = cv2.threshold(frameDelta, 25, 255, cv2.THRESH_BINARY)[1]
    # dilate the thresholded image to fill in holes, then find contours
    # on thresholded image
    thresh = cv2.dilate(thresh, None, iterations=2)
    cnts = cv2.findContours(thresh.copy(), cv2.RETR_EXTERNAL,
                            cv2.CHAIN_APPROX_SIMPLE)</code></pre>
<p>Il motion detector base &#xE8; stato ampliato in altre due classi per comprendere l&#x2019;invio di messaggi MQTT al rilevamento di un movimento ("motion detection mqtt") e lo streaming video assieme all&#x2019;invio di messaggi ("motion detection mqtt stream").</p>
</section>
<section id="fooobject-detection" class="level3" data-number="6.2.2">
<h3 data-number="6.2.2"><span class="header-section-number">6.2.2</span> Object Detection</h3>
<p>La seconda implementazione proposta per la rilevazione di anomalie o intrusioni nel sistema di videosorveglianza fa uso di reti neurali per l&#x2019;object detecion. La classe "object detection base" fa uso della rete neurale Yolo (una pi&#xF9; approfondita discussione sulla scelta delle reti &#xE8; presente nel capitolo Testing) per predire la presenza di oggetti anomali nella scena. Il codice permette di venir usato per il forward alla rete di una singola immagine, di un video, o di uno streaming da webcam. Nel mentre vengono calcolati i tempi di computazione per derivare gli FPS a cui il sistema sta andando. Assieme a questa classe &#xE8; stata implementata la variante "object detection mqtt" con l&#x2019;invio su MQTT del messaggio di anomalia e dell&#x2019;oggetto rilevato per la notifica.</p>
<pre><code>            # capture frame
            ret, image = cap.read()

            #predition
            boxes, confidences, classIDs, idxs = make_prediction(net, layer_names, labels, image, args.confidence, args.threshold)
            #draw boxes
            image = draw_bounding_boxes(image, boxes, confidences, classIDs, idxs, colors)</code></pre>
</section>
</section>
<section id="fooweb-app" class="level2" data-number="6.3">
<h2 data-number="6.3"><span class="header-section-number">6.3</span> Web App</h2>
<p>La <strong>Web App</strong> &#xE8; stata sviluppata come un prototipo funzionante, tuttavia per essere considerato completo richiederebbe ancora del lavoro di rifinitura.</p>
<section id="fooconsiderazioni-tecnologiche" class="level3" data-number="6.3.1">
<h3 data-number="6.3.1"><span class="header-section-number">6.3.1</span> Considerazioni tecnologiche</h3>
<p>L&#x2019;applicazione &#xE8; stata sviluppata utilizzando <strong>nodeJS</strong> e <strong>VueJS</strong>. Una scelta guidata dalla semplicit&#xE0; del framework javascript, che a differenza di <strong>React</strong> e <strong>Angular</strong> offre una curva di apprendimento ben pi&#xF9; bassa, favorendo lo sviluppo. <strong>VueJS</strong> forniva inoltre il vantaggio di integrarsi perfettamente con AWS <strong>Amplify</strong>, a livello di <strong>front-end</strong>. Mentre a livello di <strong>back-end</strong> le comunicazioni sono perfettamente supportate dato che anche l&#x2019;applicativo <strong>back-end</strong> &#xE8; stato sviluppato con <strong>nodeJS</strong>.</p>
<p>Il comparto estetico &#xE8; sviluppato utilizzando <strong>Vuetify</strong>, questa &#xE8; un&#x2019;estensione di <strong>VueJS</strong> che sembrava integrarsi meglio con il framework rispetto a <strong>BootstrapVue</strong>.</p>
<p>Per la comunicazione con le API <strong>REST</strong> si &#xE8; scelto di utilizzare <strong>AXIOS</strong> rispetto ad <strong>AJAX</strong>, questo perch&#xE9; risulta di facile integrazione con <strong>VueJS</strong>, supporta le <strong>SPA</strong> e consente il facile utilizzo di <code>Async</code> e <code>Await</code>.</p>
<p>Mentre per le <code>websocket</code> si &#xE8; scelto di usare le librerie di default, principalmente per la loro semplicit&#xE0; di utilizzo. &#xC8; stata valutata l&#x2019;adozione di <code>Socket.io</code> che forniva maggiori funzionalit&#xE0; e supporto a comunicazioni come l&#x2019;utilizzo di <code>fall back</code>. Tali funzionalit&#xE0;, tuttavia, non erano utili per un utilizzo cos&#xEC; basilare, pertanto l&#x2019;idea di utilizzare questa libreria &#xE8; stata accantonata.</p>
<p>Per quanto riguarda le <code>route</code> della pagina &#xE8; stato utilizzato <strong>VueRouter</strong>, essendo l&#x2019;unica alternativa.</p>
<p>Infine per facilitare lo sviluppo &#xE8; stato utilizzato <strong>Vuex</strong> che consente di accedere da pi&#xF9; punti ad un oggetto condiviso.</p>
</section>
<section id="foonote-sul-codice" class="level3" data-number="6.3.2">
<h3 data-number="6.3.2"><span class="header-section-number">6.3.2</span> Note sul codice</h3>
<p>Per questioni di velocit&#xE0; e leggibilit&#xE0; si &#xE8; deciso di dividere l&#x2019;applicativo su pi&#xF9; <code>view</code> : <strong>Home</strong> e <strong>Login</strong>.</p>
<p>Ogni <code>view</code> &#xE8; composta da pi&#xF9; componenti che a loro volta sono composti.</p>
<p>Tutti gli elementi di <strong>VueJS</strong> sono stati strutturati seguendo il modello del <strong>Single File Components</strong> che prevede di inserire il codice per lo <strong>Style</strong>(CSS), <strong>Markup</strong>(Vue/HTML) e <strong>Script</strong>(JavaScript) tutto nello stesso file.</p>
</section>
<section id="foodifficolt&#xE0;-durante-lo-sviluppo" class="level3" data-number="6.3.3">
<h3 data-number="6.3.3"><span class="header-section-number">6.3.3</span> Difficolt&#xE0; durante lo sviluppo</h3>
<p>Lo sviluppo della <strong>Web App</strong> &#xE8; stato fluido fino all&#x2019;integrazione della prima chiamata alle <strong>API</strong>. Qui ci si &#xE8; resi conto che le api non potevano essere chiamate direttamente dal <strong>Browser</strong>, mentre funzionavano perfettamente utilizzando sistemi come <strong>Postman</strong> e <strong>Reqbin</strong>.</p>
<p>E&#x2019; stato pi&#xF9; volte riscontrato l&#x2019;errore <strong>Cross-Origin Resource Sharing</strong> (CORS), che riguarda la possibilit&#xE0; di utilizzare altre sorgenti per attingere alle informazioni. Questo genere di verifica viene effettuata solo dal Browser ed &#xE8; invece saltata su Postman e simili.</p>
<p>Dopo un investigazione siamo giunti alla conclusione che in fase di <strong>sviluppo</strong> avremmo potuto consentire ogni richiesta. Abbiamo quindi aggiunto le seguenti linee di codice nel file <code>Template.yaml</code> di <strong>SAM</strong>, per istruire il proxy cors di AWS a rispondere alle richieste con i campi aggiunti:</p>
<pre><code>        Globals:
          Api:
            EndpointConfiguration: REGIONAL
            Cors:
              AllowMethods: &quot;&#39;*&#39;&quot;
              AllowHeaders: &quot;&#39;*&#39;&quot;
              AllowOrigin: &quot;&#39;*&#39;&quot;</code></pre>
<p>L&#x2019;errore ha smesso di presentarsi, ma poich&#xE9; avevamo la necessit&#xE0; di testare sempre pi&#xF9; funzioni e non era pensabile effettuare il deploy di sam per ogni prova, abbiamo iniziato ad eseguire un&#x2019; istanza di AWS <strong>Lambda</strong> localmente tramite il comando : <code>sam build &amp;&amp; sam local start-api</code>.</p>
<p>Giunti a questo punto il problema si &#xE8; ripresentato e questa volta la soluzione &#xE8; stata molto pi&#xF9; ostica da trovare, nonostante il problema fosse lo stesso, ovvero la mancanza della risposta <strong>CORS</strong>.</p>
<figure>
<img src="Images/CorsErrorFrontEnd.PNG" id="foofig:ErrorCorsBroswer" style="width:80.0%" alt="Errore lato Broswer" /><figcaption aria-hidden="true">Errore lato Broswer</figcaption>
</figure>
<figure>
<img src="Images/CorsErrorConsole.PNG" id="foofig:ErrorCorsConsole" style="width:100.0%" alt="Errore lato console" /><figcaption aria-hidden="true">Errore lato console</figcaption>
</figure>
<p>Volenterosi di utilizzare e testare le funzioni lambda localmente abbiamo cercato una soluzione che risolvesse il problema in maniera esaustiva, giungendo finalmente una <a href="https://github.com/aws/aws-sam-cli/issues/323#issuecomment-483650280">Issue</a> che ha fornito la soluzione se pur non ottimale.</p>
<p>Il comando utilizzato: <code>npx lcp &#x2013;proxyUrl http://localhost:3000/</code></p>
<p>La soluzione adottata implica l&#x2019;avviare un server proxy CORS che risponda alle richieste <strong>OPTIONS</strong> e poi reindirizzi all&#x2019;immagine docker di lambda. Ovviamente la WebApp dovra contattare il proxy e non direttamente il container.</p>
<p>Nonostante gli sviluppatori di SAM confermino il supporto alle chiamate CORS locali non siamo riusciti a farle funzionare in altra maniera.</p>
</section>
<section id="foodeployment" class="level3" data-number="6.3.4">
<h3 data-number="6.3.4"><span class="header-section-number">6.3.4</span> Deployment</h3>
<p>Il repository &#xE8; stato collegato e configurato per il continuous deployment, cos&#xEC; da pubblicare le modifiche online non appena rilasciate, se il sito compila. Il sito, essendo pubblico, &#xE8; stato protetto da password con l&#x2019;utilizzo di Amplify.</p>
</section>
</section>
<section id="foofunzioni-serverless" class="level2" data-number="6.4">
<h2 data-number="6.4"><span class="header-section-number">6.4</span> Funzioni Serverless</h2>
<p>In questa sezione del progetto sono, le principali difficolt&#xE0; affrontate sono state legate all&#x2019;apprendimento delle tecnologie <strong>AWS</strong> utilizzate:</p>
<ul>
<li><p><strong>Lambda</strong>: I due principali problemi incontrati sono stati:</p>
<ul>
<li><p>Lo sviluppo e il testing in locale che richiede l&#x2019;ausilio della <strong>SAM CLI</strong> e della <strong>AWS CLI</strong>.</p></li>
<li><p>L&#x2019;utilizzo del sdk di AWS per javascript, sopratutto quando era necessario contattare altri servizi come IoT Core o API Gateways.</p></li>
</ul></li>
<li><p><strong>IoT Core</strong>: Non sono state riscontrate particolari difficolt&#xE0; se non con i certificati che non sono in un formato compatibile con la libreria <code>UMQTT</code> di Micropython.</p></li>
<li><p><strong>CloudWatch</strong>: Consultare i log delle funzioni lambda non risulta complicato, stesso non si pu&#xF2; dire per i log delle websocket.</p></li>
<li><p><strong>IAM</strong>: Il sistema dei permessi di AWS &#xE8; molto articolato e ci sono pi&#xF9; modi per fornire i permessi, in generale la gestione dei permessi &#xE8; stata faticosa. Alcuni permessi sono molto immediati, altri come quello per consultare i log di <strong>CloudWatch</strong> delle websocket molto meno, non tanto per i permessi pi&#xF9; per il tool grafico o la sintassi di SAM.</p></li>
<li><p><strong>API gateway</strong>: L&#x2019;esposizione delle <code>API</code> <strong>REST</strong> e delle web socket non &#xE8; stata difficoltosa.</p></li>
<li><p><strong>SAM</strong>: Forse la parte pi&#xF9; complicata dell&#x2019;applicativo serverless, fornisce la possibilit&#xE0; di effettuare il deploy di <strong>Stack</strong> su <strong>AWS CloudFormation</strong>, con una sintassi tutta sua, orchestrare il deploy di : Funzioni Lambda, Regole IoT Core, Permessi IAM, Tabelle DynamoDB, API REST, Websocket e CloudWatch Event via Crono. Nonostante il grande sforzo per sfruttare al meglio SAM, il lavoro potrebbe essere ulteriormente automatizzato e perfezionato.</p></li>
</ul>
<section id="foodeployment-1" class="level3" data-number="6.4.1">
<h3 data-number="6.4.1"><span class="header-section-number">6.4.1</span> Deployment</h3>
<p>L&#x2019;intero stack che esclude il database principale, Aws Aplify e i dispositivi IOT pu&#xF2; essere dispiegato tramite il comando <code>sam build &amp;&amp; sam deploy</code> Attualmente il deploy &#xE8; dipendente da alcune variabili che sono configurabili con il flag <code>-g</code>, altre variabili sono incorporate e potrebbero essere scorporate alla stessa maniera se si volesse rendere il deploy multi-account.</p>
</section>
</section>
<section id="foodatabase-dynamodb" class="level2" data-number="6.5">
<h2 data-number="6.5"><span class="header-section-number">6.5</span> Database DynamoDB</h2>
<p>Lo sviluppo del database &#xE8; una parte critica del progetto, in un ottica di rendere l&#x2019;applicativo veloce e scalabile il pi&#xF9; possibile, abbiamo scelto di procedere con lo sviluppo di una tabella DynamoDB. DynamoDB offre una scalabilit&#xE0; e una velocit&#xE0; di interrogazione superiori ai database relazionali, per questo lo abbiamo scelto, inoltre la sua prefetta integrazione con il <strong>back-end</strong> lo rendeva ancora pi&#xF9; appetibile.</p>
<p>Le difficolt&#xE0; durante lo sviluppo del database sono state enormi. Partendo dalla documentazione e dalle guide che siamo riusciti a reperire, subito ci siamo trovati in difficolt&#xE0; con il mindset necessario allo sviluppo del database, troppo legati all&#x2019;ambito relazionale. Il database ha passato molti <strong>schemi</strong> diversi che sono stati raffinati mano a mano che la complessit&#xE0; e i meccanismi del DB venivano compresi. Questo comportava continue modifiche al DB e il testare e studiare sono diventati essenziali, motivo per cui abbiamo scelto di non includerlo all&#x2019;interno del deploy <strong>SAM</strong>, non si voleva complicare il complicato.</p>
<section id="footool-utilizzati" class="level3" data-number="6.5.1">
<h3 data-number="6.5.1"><span class="header-section-number">6.5.1</span> Tool utilizzati</h3>
<p>Durante lo sviluppo abbiamo utilizzato due strumenti per aiutarci aiutarci nella comprensione e nello sviluppo del sistema:</p>
<ul>
<li><p><strong>NoSQL Workbench</strong> Il nuovo tool grafico di AWS ci ha permesso di visualizzare con maggiore chiarezza il database e di elaborare le query utilizzando <strong>PartiQL</strong>. Inoltre ci ha anche permesso di effettuare la creazione di tabelle utilizzando la connessione ad AWS.</p></li>
</ul>
<p><strong>PartiQL</strong> Una gradita sorpresa durante lo studi e lo sviluppo del database. Infatti questo consente di interrogare <strong>DynamoDB</strong> utilizzando la classica sintassi <strong>SQL</strong>, molto pi&#xF9; espressiva dell&#x2019;<strong>SDK</strong> javascript. Purtroppo l&#x2019;implementazione al supporto <strong>PartiQL</strong> non &#xE8; supportata totalmente e quindi grossa parte della sintassi <strong>SQL</strong> come proiezioni e query annidate non sono disponibili. Questo rende l&#x2019;implementazione delle query pi&#xF9; frammentata, e ci ha obbligato a riscrivere varie parti di codice e DB. Tali limiti sono intrinseci di DynamoDB e non una mancanza di sviluppo parziale.</p>
</section>
</section>
<section id="fooimmagini-prototipi" class="level2" data-number="6.6">
<h2 data-number="6.6"><span class="header-section-number">6.6</span> Immagini prototipi</h2>
<figure>
<img src="Images/SmartCam.jpeg" id="foofig:SmartCam" style="width:100.0%" alt="Prototipo Smart Cam" /><figcaption aria-hidden="true">Prototipo Smart Cam</figcaption>
</figure>
<figure>
<img src="Images/SmartCollar.jpeg" id="foofig:SmartCollar" style="width:100.0%" alt="Prototipo Smart Collar" /><figcaption aria-hidden="true">Prototipo Smart Collar</figcaption>
</figure>
<figure>
<img src="Images/SmartCage.png" id="foofig:SmartCage" style="width:100.0%" alt="Prototipo Smart Cage" /><figcaption aria-hidden="true">Prototipo Smart Cage</figcaption>
</figure>
</section>
</section>
<section id="footesting-e-performance" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Testing e Performance</h1>
<section id="fooautomazione-gabbia-e-monitoraggio-salute" class="level2" data-number="7.1">
<h2 data-number="7.1"><span class="header-section-number">7.1</span> Automazione Gabbia e Monitoraggio Salute</h2>
<section id="foohardware-1" class="level3" data-number="7.1.1">
<h3 data-number="7.1.1"><span class="header-section-number">7.1.1</span> Hardware</h3>
<p>Per quanto riguarda l&#x2019;automazione di cibo e acqua e il monitoraggio dei parametri vitali dell&#x2019;animale sono state testate multiple soluzioni hardware. In fase di validazione del progetto sono stati prese in esame principalmente due board che soddisfacessero i requisiti di economicit&#xE0;, connettivit&#xE0; e prestazioni: L&#x2019;ESP8266 e il successore ESP32. Entrambi offrono la connettivit&#xE0; Wi-Fi integrata e buona potenza computazionale, cosa di cui &#xE8; carente la board Arduino, e un costo contenuto (5&#x20AC; per il primo e 7&#x20AC; per il secondo, dati del primo semestre 2021) rispetto alla board Raspberry. Quest&#x2019;ultima board offre connettivit&#xE0; e prestazioni ma i costi sono decisamente fuori budget per il committente e per la natura distribuita dei compiti. La piattaforma ESP si &#xE8; rivelata un buon compromesso e quindi si &#xE8; passati a testarne i due differenti modelli.</p>
<p>Dopo i testing eseguiti in fase iniziale sono emerse differenze sostanziali nei tempi di avvio del programma e di connessione. Inoltre l&#x2019;ESP8266 ha riscontrato spesso problemi nel caricamento dei file e nell&#x2019;esecuzione di micropython. Di seguito si riporta la tabella riassuntiva per i tempi di esecuzione/comunicazione, accompagnati dalle caratteristiche dell&#x2019;hardware.</p>
<p><img src="DrawIo/ConfrontoMicrocontrollori.png" style="width:100.0%" alt="image" /></p>
<p>Alla luce della minima differenza di prezzo tra i due device rispetto alla capacit&#xE0; computazionale, la scelta &#xE8; ricaduta sul pi&#xF9; recente ESP32.</p>
</section>
</section>
<section id="foovideosorveglianza" class="level2" data-number="7.2">
<h2 data-number="7.2"><span class="header-section-number">7.2</span> Videosorveglianza</h2>
<section id="foohardware-2" class="level3" data-number="7.2.1">
<h3 data-number="7.2.1"><span class="header-section-number">7.2.1</span> Hardware</h3>
<p>Come anticipato in precedenza, il lato visione, di per se pi&#xF9; computazionalmente oneroso, ha reso necessaria un&#x2019;analisi pi&#xF9; approfondita delle performance e la scelta &#xE8; ricaduta su Raspberry Pi e ESP32-CAM. Inizialmente stato implementato un server web in C, per l&#x2019;ESP ma il development &#xE8; stato in seguito interrotto per la scarsa potenza potenza di quest&#x2019;ultimo nell&#x2019;elaborazione delle immagini. E&#x2019; stato tuttavia ritenuto valido per un&#x2019;alternativa economica per il semplice streaming video senza elaborazione e notifica. Le board Raspberry Pi testate sono state le seguenti, con i rispettivi tempi di elaborazione:</p>
<p><img src="DrawIo/ConfrontoRaspberry.png" style="width:100.0%" alt="image" /></p>
<p>* i tempi si riferiscono all&#x2019;attesa media per ottenere i risultati di object-detection attraverso una rete neurale con architettura Yolo3 con lo stesso set di immagini.</p>
<p>Considerando il rapporto costo/prestazioni, la scelta &#xE8; ricaduta sul Raspberry Pi 3 B+ che con soli 0.7 secondi di distacco dal suo successore si posiziona su una fascia decisamente pi&#xF9; economica.</p>
</section>
<section id="foosoftware" class="level3" data-number="7.2.2">
<h3 data-number="7.2.2"><span class="header-section-number">7.2.2</span> Software</h3>
<p>Per quanto riguarda il software sono state testate le prestazioni dei due metodi per la detection di anomalie/intrusioni.Il secondo, pi&#xF9; elaborato, su riconoscimento oggetti per mezzo di una rete neurale.</p>
<section id="foomotion-detection-1" class="level4" data-number="7.2.2.1">
<h4 data-number="7.2.2.1"><span class="header-section-number">7.2.2.1</span> Motion Detection</h4>
<p>Il primo, pi&#xF9; lineare, si basa su elaborazione delle immagini tramite sottrazione dello sfondo per rilevare del movimento. Le semplici operazioni di sfocatura gaussiana, differenza, soglia e calcolo dell&#x2019;area sono state studiate per ottenere alte prestazioni circa la velocit&#xE0; di esecuzione dell&#x2019;algoritmo. I test sperimentali sulla piattaforma scelta Raspberry Pi 3B+ hanno rilevato una media di 30 FPS sul materiale di test. Questa misura si &#xE8; rivelata parecchio costante, poich&#xE9; l&#x2019;algoritmo non effettua un&#x2019;analisi semantica delle immagini ma semplicemente delle operazioni matematiche indipendentemente dal contenuto. L&#x2019;unico overhead dell&#x2019;algoritmo risiede infatti nel calcolo dell&#x2019;area dell&#x2019;immagine cambiata qualora presente. Pi&#xF9; questa &#xE8; grande pi&#xF9; tempo viene impiegato per calcolarla. Rispetto ai tempi di esecuzione e alle normale fluttuazioni delle prestazioni non &#xE8; stata rilevata una differenza degna di nota (Si vedano gli FPS nonostante la grande area rilevata in [Fig. <a href="#foofig:MDcomparison" data-reference-type="ref" data-reference="fig:MDcomparison">7.1</a>]</p>
<figure>
<img src="Images/MDcomparison.png" id="foofig:MDcomparison" style="width:50.0%" alt="Surveillance with Motion Detection" /><figcaption aria-hidden="true">Surveillance with Motion Detection</figcaption>
</figure>
<p>La velocit&#xE0; dell&#x2019;algoritmo va a discapito della precisione dello stesso. A seguito delle rilevazioni la matrice di confusione risulta non ottimale. Le motivazioni principali trovate risiedono nei seguenti scenari:</p>
<ul>
<li><p>qualora una figura da rilevare stesse ferma o si muovesse lentamente, la soglia non sarebbe abbastanza alta da venir rilevata e ci&#xF2; comporta dei falsi negativi. Non avendo nozione della semantica dell&#x2019;immagine, l&#x2019;algoritmo non pu&#xF2; venir calibrato ulteriormente.</p></li>
<li><p>qualora un oggetto irrilevante (es: una mosca che passa vicino sulle lenti) produca un cambiamento significativo nell&#x2019;immagine, la soglia viene superata e viene prodotto un falso positivo. Anche qui la mancanza di discernimento dell&#x2019;algoritmo non pu&#xF2; essere superata se non cambiandolo.</p></li>
<li><p>qualora l&#x2019;oggetto estraneo sia lontano l&#x2019;area di cambiamento risulta piccola e non supera la soglia, producendo falsi negativi. Se la soglia viene abbassata si incorre in falsi positivi per via di minimi cambiamenti ambientali.</p></li>
</ul>
<p>La matrice di confusione risultante in [Fig. <a href="#foofig:MDmatrix" data-reference-type="ref" data-reference="fig:MDmatrix">7.2</a>] risulta chiaramente sbilanciata con parecchi falsi positivi. Questo deriva chiaramente dall&#x2019;impossibilit&#xE0; discussa di discernere tra oggetti in movimento "non allarmanti" e viceversa. Per ovviare a questo problema nella sezione successiva si discuter&#xE0; l&#x2019;uso delle reti neurali e le prestazioni inerenti l&#x2019;uso dell&#x2019;object-detection.</p>
<figure>
<img src="DrawIo/ConfusionMatrixMotDet.png" id="foofig:MDmatrix" style="width:90.0%" alt="Confusion matrix of Motion Detection" /><figcaption aria-hidden="true">Confusion matrix of Motion Detection</figcaption>
</figure>
</section>
<section id="fooobject-detection-1" class="level4" data-number="7.2.2.2">
<h4 data-number="7.2.2.2"><span class="header-section-number">7.2.2.2</span> Object Detection</h4>
<p>Il secondo metodo testato per la sorveglianza &#xE8; l&#x2019;object detection. Sono state confrontate 4 reti neurali per trovare la pi&#xF9; adatta tra prestazioni e precisione. Nonostante sia stata scelta la board Raspberry tenendo il considerazione la potenza di calcolo, i fotogrammi al secondo hanno subito una brusca riduzione rispetto alla soluzione precedente. Il parametro minimo &#xE8; stato fissato a 1 FPS, sotto il quale il divario temporale tra due immagini analizzate mancherebbe la rilevazione di possibili avvenimenti. La causa principale di tale crollo nelle prestazioni utilizzando questa soluzione &#xE8; la mancanza di una GPU adatta nei Raspberry. Tale carenza &#xE8; comunque colmabile con l&#x2019;acquisto di espansioni USB dedicate all&#x2019;espansione delle capacit&#xE0; grafiche della board (TPU). Immediatamente &#xE8; risultato palese che le architetture delle reti tradizionalmente usate sui pc fossero troppo pesanti per il sistema ospitante. Per referenza &#xE8; stata lasciata l&#x2019;architettura (gi&#xE0; di per se performante) Yolo3. Il focus quindi &#xE8; stato soprattutto sull&#x2019;individuazione di reti "leggere" che offrissero prestazioni adeguate. Sono state confrontate e testate le varie versioni "Tiny" della stessa rete come in tabella seguente:</p>
<p><img src="DrawIo/ConfrontoNeuralNetworks.png" style="width:100.0%" alt="image" /></p>
<p>Dopo l&#x2019;analisi &#xE8; risultato chiara la scelta della versione Yolo V4-Tiny, con il miglior numero di rilevazioni e una velocit&#xE0; adeguata alla videosorveglianza.</p>
<figure>
<img src="Images/ODcomparison.png" id="foofig:ODcomparison" style="width:100.0%" alt="Surveillance with Object Detection" /><figcaption aria-hidden="true">Surveillance with Object Detection</figcaption>
</figure>
<p>Le prestazioni sono state a livello di precisione sono state alte, come ci si aspetta da una rete neurale comparata "in the wild" a metodi tradizionali. Di seguito si riporta la matrice di confusione delle prove effettuate:</p>
<figure>
<img src="DrawIo/ConfusionMatrixObjDet.png" id="foofig:ODmatrix" style="width:90.0%" alt="Confusion matrix of Object Detection" /><figcaption aria-hidden="true">Confusion matrix of Object Detection</figcaption>
</figure>
</section>
</section>
</section>
</section>
<section id="fooanalisi-di-deployment-su-larga-scala" class="level1" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> Analisi di Deployment su Larga Scala</h1>
<p>L&#x2019;applicativo &#xE8; stato modellato in ogni sua parte per scalare facilmente all&#x2019;occorrenza. Il design distribuito e in cloud ne facilita l&#x2019;eventuale evoluzione su larga scala. Verranno di seguito brevemente analizzati due scenari:</p>
<ul>
<li><p><strong>Evoluzione Interna</strong> In termini di scalabilit&#xE0; del singolo software lo scenario pi&#xF9; realistico consiste nell&#x2019;aggiunta di elementi (gabbie o animali) da parte di un grande canile. L&#x2019;aggiunta, anche cospicua, di elementi non porterebbe ulteriore complessit&#xE0; al sistema. Gli unici requisiti riguardano comprare l&#x2019;hardware specifico da installare. Questo si occuper&#xE0; attraverso il programma di mandare i dati direttamente al cloud, il quale li processer&#xE0; e mostrer&#xE0; le informazioni aggiornate sull&#x2019;applicativo.</p></li>
<li><p><strong>Diffusione su Larga Scala</strong> In termini di diffusione del software in molteplici copie lo scenario riguarderebbe l&#x2019;adozione dell&#x2019;applicativo da parte di molteplici amministrazioni. Grazie all&#x2019;adozione dei servizi AWS in Cloud, l&#x2019; <strong>availability</strong> e la <strong>scalability</strong> del sistema sono garantite anche ad alti livelli.</p></li>
</ul>
<p>L&#x2019;attuale architettura hub and spoke, si rivela essere la scelta pi&#xF9; fattibile anche su larga scala, data la sua buona integrazione con MQTT.</p>
<p>Uno dei principali punti di criticit&#xE0; dell&#x2019;attuale architettura, nel momento in cui verrebbe fatto un deploy su larga scala, &#xE8; dato dalla forte dipendenza del sistema dalla disponibilit&#xE0; di AWS in quanto se l&#x2019;infrastruttura web crollasse o avesse dei problemi che ne influenzano il servizio, l&#x2019;applicativo smetterebbe di funzionare. Questo problema pu&#xF2; essere affrontato principalmente in due modi:</p>
<ul>
<li><p>effettuare una replica dei servizi e dei dati in un&#x2019;altra <strong>Availability Zone</strong> che si trova sotto la stessa <strong>region</strong> per ottenere <strong>fault tolerance</strong></p></li>
<li><p>effettuare una replica in una diversa regione di AWS. questa far&#xE0; da base per l&#x2019;applicazione di una strategia di <strong>disaster recovery</strong>.</p></li>
</ul>
<figure>
<img src="DrawIo/ScaledArchitecture.png" id="foofig:NewArch" style="width:100.0%" alt="Nuova architettura in generale" /><figcaption aria-hidden="true">Nuova architettura in generale</figcaption>
</figure>
<section id="fooanalisi-interna" class="level2" data-number="8.1">
<h2 data-number="8.1"><span class="header-section-number">8.1</span> Analisi Interna</h2>
<p>I cambiamenti nella rete interna sono relativamente limitati, si suddividono in due parti</p>
<section id="fooadozione-di-hw-specifico" class="level3" data-number="8.1.1">
<h3 data-number="8.1.1"><span class="header-section-number">8.1.1</span> Adozione di HW specifico</h3>
<p>L&#x2019;utilizzo di Micro-python consente di sviluppare codice per una grande famiglia di micro-controllori. L&#x2019;ESP-32 &#xE8; stato scelto anche pensando ad uno sviluppo futuro dato che la sua famiglia presenta varie board che forniscono feature adatte agli ambienti pi&#xF9; disparati. Su larga scala &#xE8; ragionevole pensare che il codice di micro-python opportunamente riadattato consenta la scelta di una qualcunque di queste board alternative fornendo cos&#xEC; un&#x2019;adattabilit&#xE0; in termini di hardware elevata. Ad esempio, vi &#xE8; la possibilit&#xE0; di integrare ESP che dispongono di tipi di connessione diversi, come l&#x2019;ESP32-Ethernet-Kit V1.2 e l&#x2019;ESP32-PICO-KIT-1.</p>
</section>
<section id="foocentralina-controllo" class="level3" data-number="8.1.2">
<h3 data-number="8.1.2"><span class="header-section-number">8.1.2</span> Centralina controllo</h3>
<p>Dato che ogni ESP gestisce un singolo cane e ha una funzione critica, avere un ulteriore livello di controllo dell&#x2019;ESP locale pu&#xF2; aiutare nella preventiva rilevazione dei guasti locali dato che la rete locale &#xE8; pi&#xF9; affidabile ha una minore propensione ai guasti, fornendo alla centralina la possibilit&#xE0; di diagnosticare tramite messaggi interni eventuali guasti, effettuando controlli periodici.</p>
<p>L&#x2019;integrazione delle funzioni tralasciate nell&#x2019;applicativo locale realizzato durante questo progetto possono essere introdotte tramite <strong>Cloud formation</strong> mediante l&#x2019;utilizzo di <strong>SAM</strong> (Serverless Application Model). Alcune di queste funzioni sono:</p>
<ul>
<li><p><strong>Amazon Cognito:</strong> attualmente il sistema gestisce il salvataggio degli utenti all&#x2019;interno del DataBase. In un&#x2019;ottica di deployment su larga scala l&#x2019;attuale soluzione risulterebbe poco adatta. Un approccio decisamente migliore sarebbe quello di affidare la gestione degli utenti ad Amazon Cognito ed integrarlo con Amazon AWS Amplify.</p></li>
<li><p><strong>Dynamo DB:</strong> il sistema attuale utilizza due tabelle Dynamo DB, la prima &#xE8; creata tramite SAM e viene utilizzata per la gestione delle WebSocket, la seconda &#xE8; creata manualmente e contiene i dati del canile. Dato che la seconda modalit&#xE0; non &#xE8; applicabile su larga scala, sarebbe necessario automatizzare anche la creazione del database principale, specificando le varie propriet&#xE0; come lo schema e i valori di throughput.</p></li>
<li><p><strong>IoT Core:</strong> &#xE8; possibile automatizzare il rilascio dei certificati e dei permessi necessari per i dispositivi e aggiungere il relativo dispositivo <strong>shadow</strong> che mantiene l&#x2019;ultimo stato conosciuto consentendo cos&#xEC; di interrogare il dispositivo anche quando offline.</p></li>
</ul>
<p>La libreria UMQTT di Micro-Python consente di utilizzare solo la QoS (Quality of Service) di livello 1 o 0. Attualmente il sistema utilizza QoS di livello 0. Poich&#xE9; questo applicativo non ha particolari vincoli di velocit&#xE0; per lo scambio dei messaggi &#xE8; possibile valutare anche l&#x2019;utilizzo di una QoS superiore. Nel caso in cui si volesse avere la possibilit&#xE0; di avere una QoS di livello 2, che garantisce di ricevere messaggi con certezza, sar&#xE0; necessario ricorre ad un&#x2019;alternativa poich&#xE9; UMQTT supporta fino al livello 1. Sar&#xE0; inoltre necessario sostituire il broker MQTT di IoT Core con un broker in grado di supportare lvl 2, come ad esempio HiveMQ</p>
</section>
</section>
<section id="fooanalisi-esterna" class="level2" data-number="8.2">
<h2 data-number="8.2"><span class="header-section-number">8.2</span> Analisi Esterna</h2>
<p>Il database principale gestisce attualmente i dati dei cani, le relative rilevazioni e gli utenti. Questa struttura si &#xE8; rivelata necessaria poich&#xE9; ai fini della realizzazione del progetto non vi era la possibilit&#xE0; di sviluppare una parte gestionale in quanto non inerente al corso. Uno sviluppo futuro vede necessaria una rielaborazione del sistema che permetta di effettuare una netta divisione tra la parte gestionale e quella relativa ai dati provenienti dai dispositivi di sensing. Questo porterebbe ad utilizzare il Database attuale solo per immagazzinare le rilevazioni, le quali generano una grande quantit&#xE0; di record. La gestione dei profili dei cani e di quelli degli utenti, andrebbe invece considerata a parte all&#x2019;interno di un sistema prettamente gestionale. Si potrebbe, ad esempio, utilizzare Amazon Cognito per gestire gli utenti e un DB relazionale per i profili dei cani, il quale porterebbe come vantaggio l&#x2019;integrit&#xE0; referenziale dei dati e seppur meno performante dovrebbe gestire pochi record.</p>
</section>
<section id="fooanalisi-complessiva" class="level2" data-number="8.3">
<h2 data-number="8.3"><span class="header-section-number">8.3</span> Analisi complessiva</h2>
<section id="foosicurezza" class="level3" data-number="8.3.1">
<h3 data-number="8.3.1"><span class="header-section-number">8.3.1</span> Sicurezza</h3>
<p>Nella realizzazione della soluzione attuale non ci si &#xE8; preoccupati particolarmente della sicurezza. Attualmente le API REST disponibili su API Gateway sono prive di qualunque tipo di autenticazione, questo vale anche per le WEB Socket. Per effettuare il deploy dell&#x2019;applicativo &#xE8; necessario autenticare ogni richiesta utilizzando, ad esempio API Gateway Lambda Authorizer. Ci&#xF2; richiede la scrittura di policy dedicate e maggiormente restrittive rispetto alle attuali full access policy.</p>
<p>Attualmente i micro-controllori, per autenticarsi presso AWS, utilizzano una chiave privata senza verificare la validit&#xE0; del certificato del server. Questo espone i micro-controllori ad un attacco di tipo <strong>man in the middle</strong>. Se si volesse fare un utilizzo reale del sistema, questo sarebbe un problema da risolvere in maniera prioritaria.</p>
<p>Se il sistema dovesse essere dispiegato su larga scala si dovrebbe tenere in considerazione il fatto che, a fronte di modifiche a livello di codice, sarebbe pesante dover fare ogni volta il deploy in corso d&#x2019;opera per testare le funzionalit&#xE0;. Per questo motivo &#xE8; utile fare in modo che le funzionalit&#xE0; possano essere provate anche in locale, permettendo cos&#xEC; di fare il deploy solo quando davvero necessario. Per abilitare il testing in locale &#xE8; possibile utilizzare SAM CLI che permette di hostare localmente un&#x2019;istanza Docker per le chiamale Lambda.</p>
</section>
</section>
</section>
<section id="foopiano-di-lavoro" class="level1" data-number="9">
<h1 data-number="9"><span class="header-section-number">9</span> Piano di lavoro</h1>
<p>Il lavoro &#xE8; stato svolto utilizzando un approccio Scrum, con quattro sprint, pi&#xF9; uno iniziale incentrato sullo studio delle tecnologie.</p>
<section id="foocontributi" class="level2" data-number="9.1">
<h2 data-number="9.1"><span class="header-section-number">9.1</span> Contributi</h2>
<p>Di seguito vi &#xE8; una descrizione delle mansioni che sono state svolte dai membri del gruppo.</p>
<section id="foosara-kiade" class="level5" data-number="9.1.0.0.1">
<h5 data-number="9.1.0.0.1"><span class="header-section-number">9.1.0.0.1</span> Sara Kiade</h5>
<ul>
<li><p>progettazione e realizzazione del database</p></li>
<li><p>implementazione logiche di interrogazione e calcolo nel back-end della Web-App</p></li>
<li><p>implementazione e testing delle funzioni nel front end</p></li>
<li><p>stesura template delle funzioni nel back-end</p></li>
<li><p>configurazione SAM</p></li>
<li><p>prototyping della sensoristica</p></li>
<li><p>realizzazione diagrammi sequenza</p></li>
</ul>
</section>
<section id="foogyordan-caminati" class="level5" data-number="9.1.0.0.2">
<h5 data-number="9.1.0.0.2"><span class="header-section-number">9.1.0.0.2</span> Gyordan Caminati</h5>
<ul>
<li><p>implementazione del front-end</p></li>
<li><p>integrazione nelle adeguate pagine del front-end delle chiamate al backend</p></li>
<li><p>configurazione SAM</p></li>
<li><p>implementazione di alcune funzioni nel backend</p></li>
<li><p>scheduling di funzioni lambda innescate da Crono Cloud Watch, MQTT, Api Gateway</p></li>
<li><p>implementazione scheduler Micropython</p></li>
<li><p>prototyping della sensoristica</p></li>
<li><p>realizzazione diagrammi sequenza</p></li>
</ul>
</section>
<section id="fooigor-lirussi" class="level5" data-number="9.1.0.0.3">
<h5 data-number="9.1.0.0.3"><span class="header-section-number">9.1.0.0.3</span> Igor Lirussi</h5>
<ul>
<li><p>implementazione scheduler Micropython</p></li>
<li><p>implementazione funzioni core di Micropython e classi per sensori/attuatori</p></li>
<li><p>implementazione sistema di videosorveglianza con motion detecion e object detection</p></li>
<li><p>implementazione script di automatizzazione caricamento file</p></li>
<li><p>prototyping della sensoristica</p></li>
<li><p>progettazione e implementazione macchina a stati</p></li>
</ul>
<p>La collocazione temporale degli sprint &#xE8; descritta nel seguente diagramma di Gantt:</p>
<figure>
<img src="DrawIo/GanttChart.png" id="foofig:Gantt" style="width:100.0%" alt="Gantt Chart del progetto" /><figcaption aria-hidden="true">Gantt Chart del progetto</figcaption>
</figure>
</section>
</section>
</section>
<section id="foosprints" class="level1" data-number="10">
<h1 data-number="10"><span class="header-section-number">10</span> Sprints</h1>
<section id="foosvolgimento" class="level2" data-number="10.1">
<h2 data-number="10.1"><span class="header-section-number">10.1</span> Svolgimento</h2>
<p>Gli sprint sono stati portati avanti nel seguente modo:</p>
<section id="foosprint-planning" class="level5" data-number="10.1.0.0.1">
<h5 data-number="10.1.0.0.1"><span class="header-section-number">10.1.0.0.1</span> Sprint Planning</h5>
<p>Pianificazione a inizio sprint degli obiettivi, tempistiche e responsabilit&#xE0; nel periodo dello sprint corrente. Diviso in due parti:</p>
<ul>
<li><p><strong>parte 1</strong> Viene raffinato e rivisto il product backlog, viene effettuata la scelta dello sprint goal (what).</p></li>
<li><p><strong>parte 2</strong> Si decidono gli item e viene raffinato come implementarli (how). Effettuato con solo il team senza la figura del product owner</p></li>
</ul>
</section>
<section id="fooiterativo-daily-scrum" class="level5" data-number="10.1.0.0.2">
<h5 data-number="10.1.0.0.2"><span class="header-section-number">10.1.0.0.2</span> [Iterativo] Daily scrum</h5>
<p>Breve meeting svolto giornalmente. Viene utilizzato per gli aggiornamenti sull&#x2019;andamento del progetto, senza scendere nei dettagli implementativi.</p>
</section>
<section id="foooccasionale-pair-programming" class="level5" data-number="10.1.0.0.3">
<h5 data-number="10.1.0.0.3"><span class="header-section-number">10.1.0.0.3</span> [Occasionale] Pair Programming </h5>
<p>Utilizzato per risolvere problemi che causano il blocco di un componente del team per parecchio tempo su una issue.</p>
</section>
<section id="foomeeting-finale" class="level5" data-number="10.1.0.0.4">
<h5 data-number="10.1.0.0.4"><span class="header-section-number">10.1.0.0.4</span> Meeting finale</h5>
<p>Riflessioni e considerazioni finali sullo spint passato. Suggerimenti per migliorare il prossimo. Diviso in tre parti:</p>
<ul>
<li><p><strong>Product backlog refinement</strong> aggiunta di dettagli e riordino del product backlog</p></li>
<li><p><strong>Sprint review</strong> &#xE8; stato ispezionato l&#x2019;incremento, il Minimum Viable Product o di risultati sul processo. Discernere cosa &#xE8; stato fatto e cosa no</p></li>
<li><p><strong>Retrospettiva</strong> Considerazioni sul team stesso e sui miglioramenti per il prossimo sprint.</p></li>
</ul>
</section>
</section>
<section id="foosprint-0" class="level2" data-number="10.2">
<h2 data-number="10.2"><span class="header-section-number">10.2</span> Sprint 0</h2>
<p>All&#x2019;interno dello sprint 0 il focus &#xE8; stato sullo scegliere le giuste tecnologie di sviluppo e sull&#x2019;apprenderle in maniera sufficiente per il kick-off del progetto. L&#x2019;obiettivo &#xE8; stato raggiungere una conoscenza e competenza minima per sviluppare il design in maniera consapevole e ottimale.</p>
<section id="foodeliverables" class="level5" data-number="10.2.0.0.1">
<h5 data-number="10.2.0.0.1"><span class="header-section-number">10.2.0.0.1</span> Deliverables</h5>
<p>al termine di questo sprint si sono acquisite le competenze di base per poter iniziare a lavorare con AWS e i dispositivi IoT. Inoltre ci si &#xE8; portati avanti con lo scheletro del sito.</p>
<ul>
<li><p>ambiente di lavoro Linux standardizzato e virtualizzato</p></li>
<li><p>sito linkato, con le prime due pagine base: home e login</p></li>
<li><p>ESP32 con firmware installato MicroPython, script e guida all&#x2019;uso</p></li>
<li><p>codice per sensori base, test relativi e stubs per eseguirli senza necessit&#xE0; del micro-controllore</p></li>
<li><p>repository software con CI e test automatizzati</p></li>
<li><p>database progettato e popolato con qualche dato ai fini di testing</p></li>
</ul>
</section>
</section>
<section id="foosprint-1" class="level2" data-number="10.3">
<h2 data-number="10.3"><span class="header-section-number">10.3</span> Sprint 1</h2>
<p>All&#x2019;interno dello sprint 1 il focus &#xE8; stato sull&#x2019;usare le competenze tecnologiche acquisite precedentemente per sviluppare i componenti principali del progetto. Sono stati scelti come obiettivi le user stories per l&#x2019;automatizzazione di cibo e acqua e la visualizzazione delle informazioni relative a un animale sulla webpage.</p>
<section id="foodeliverables-1" class="level5" data-number="10.3.0.0.1">
<h5 data-number="10.3.0.0.1"><span class="header-section-number">10.3.0.0.1</span> Deliverables</h5>
<p>al termine di questo sprint sono state implementate le funzioni base dei maggiori componenti per l&#x2019;automatizzazione fisica di cibo e acqua e il relativo prototipo fisico. Sono state aggiunte sull&#x2019;applicativo la vista delle informazioni dell&#x2019;animale e l&#x2019;impostazione del cibo da erogargli.</p>
<ul>
<li><p>codice per i sensori/attuatori per acqua e cibo, con stubs, test e automatizzazione. (Livello acqua, elettrovalvola, motore, bilancia, laser e rilevatore di luce)</p></li>
<li><p>prototipo fisico per i sensori per acqua e cibo.</p></li>
<li><p>database migliorato e rifattorizzato</p></li>
<li><p>visualizzazione dei dati del cane sul sito</p></li>
<li><p>visualizzazione dei grafici delle statistiche sul sito</p></li>
</ul>
</section>
</section>
<section id="foosprint-2" class="level2" data-number="10.4">
<h2 data-number="10.4"><span class="header-section-number">10.4</span> Sprint 2</h2>
<p>Nello sprint 2 il focus &#xE8; stato sul realizzare la logica d&#x2019;orchestrazione della sensoristica e l&#x2019;integrazione tra essa e l&#x2019;applicativo per mezzo del protocollo MQTT. Sono stati prodotti gli artefatti di documentazione e schemi esemplificativi. Inoltre, &#xE8; stato dato peso alla creazione delle query che permettono di integrare le funzioni del sito con il database. In particolare ci si &#xE8; concentrati sulle user-stories prioritarie, che costituiscono il core del dominio.</p>
<section id="foodeliverables-2" class="level5" data-number="10.4.0.0.1">
<h5 data-number="10.4.0.0.1"><span class="header-section-number">10.4.0.0.1</span> Deliverables</h5>
<ul>
<li><p>sviluppate query necessarie alla logica centrale dell&#x2019;applicazione web</p></li>
<li><p>grafici per la temperatura e l&#x2019;umidit&#xE0; nell&#x2019;applicazione web</p></li>
<li><p>implementata coverage dei test Python, con relativa pagina web su Github pages.</p></li>
<li><p>aggiunta Quality Assurance con SonarCloud, Codacy e Codefactor</p></li>
<li><p>implementata Continuous Delivery con GitHub Actions e GitHub Releases</p></li>
<li><p>implementata macchina a stati per food delivery e water automation</p></li>
</ul>
</section>
</section>
<section id="foosprint-3" class="level2" data-number="10.5">
<h2 data-number="10.5"><span class="header-section-number">10.5</span> Sprint 3</h2>
<p>Nello sprint 3 sono state implementate le query che verranno chiamate dal sito per mostrare gli elementi all&#x2019;utente. Inoltre, &#xE8; stato migrato il codice JavaScript in un repository dedicato che permette il deployment delle funzioni in automatico su AWS con SAM. Sono state sviluppate le funzioni per ottenere i dati della sensoristica del collare smart, implementando la logica per il controllo dei valori e l&#x2019;invio delle notifiche su MQTT.</p>
<section id="foodeliverables-3" class="level5" data-number="10.5.0.0.1">
<h5 data-number="10.5.0.0.1"><span class="header-section-number">10.5.0.0.1</span> Deliverables</h5>
<ul>
<li><p>sviluppate query complesse necessarie alla logica centrale dell&#x2019;applicazione web</p></li>
<li><p>repository dedicato delle funzioni JavaScript per AWS</p></li>
<li><p>setup framework SAM per automazione AWS</p></li>
<li><p>prototipo fisico per i sensori di temperatura e battito</p></li>
<li><p>implementata macchina a stati per smart-collar heartbeat e temperature</p></li>
</ul>
</section>
</section>
<section id="foosprint-4" class="level2" data-number="10.6">
<h2 data-number="10.6"><span class="header-section-number">10.6</span> Sprint 4</h2>
<p>Lo sprint 4 &#xE8; stato il pi&#xF9; impegnativo, perch&#xE9; vi era la necessit&#xE0; di chiudere il progetto, portando a termine tutti i task preventivati. Una grossa parte dello sprint &#xE8; stata dedicata all&#x2019;integrazione delle diverse parti, alla chiusura delle ultime interrogazioni al database, all&#x2019;inserimento degli ultimi pezzi dell&#x2019;interfaccia grafica che permettono all&#x2019;utente di interagire con il back-end e alla conclusione del sistema di sorveglianza.</p>
<section id="foodeliverables-4" class="level5" data-number="10.6.0.0.1">
<h5 data-number="10.6.0.0.1"><span class="header-section-number">10.6.0.0.1</span> Deliverables</h5>
<ul>
<li><p>Completamento WebApp che permette all&#x2019;utente di interagire con il sistema, visualizzando i dati e apportando delle modifiche.</p></li>
<li><p>Completamento Back-end che gestisce la logica del sito</p></li>
<li><p>Completamento gestione di sensori, attuatori e sistema di sorveglianza.</p></li>
</ul>
</section>
</section>
</section>
<section id="fooconclusioni" class="level1" data-number="11">
<h1 data-number="11"><span class="header-section-number">11</span> Conclusioni</h1>
<p>Al termine del percorso che ha portato alla realizzazione di questo progetto &#xE8; stato raggiunto un risultato che riteniamo molto soddisfacente. Sono state utilizzate e integrate diverse tecnologie, il che ci ha permesso di acquisire ed affinare competenze a tutto tondo. Riteniamo inoltre che il progetto sia stato particolarmente ambizioso e gli sforzi sono stati commisurati alla soddisfazione finale per averlo completato. Questo lavoro, inoltre, potrebbe rappresentare una buona base di partenza per lo sviluppo di un sistema reale che porti un reale vantaggio alla realt&#xE0; dei rifugi per animali.</p>
<section id="foosviluppi-futuri" class="level2" data-number="11.1">
<h2 data-number="11.1"><span class="header-section-number">11.1</span> Sviluppi Futuri</h2>
<p>In futuro sarebbe possibile estendere il sistema aggiungendo una parte gestionale. I due canili che abbiamo interpellato, infatti, sono sprovvisti anche della pi&#xF9; basilare forma di sistema informatico, fatta eccezione per l&#x2019;anagrafe canina che per&#xF2; non &#xE8; ottimizzata per l&#x2019;utilizzo che ne devono fare e ancora tanto lavoro viene affidato alle capacit&#xE0; di ragionamento e deduzione del personale del canile. Si potrebbe inoltre integrare il sistema aggiungendo altre feature, come l&#x2019;inserimento di un nuovo cane mediante la lettura dei dati direttamente dal chip oppure l&#x2019;introduzione di una pi&#xF9; importante elaborazione dei dati, soprattutto per quanto riguarda le immagini provenienti dalla videocamera che potrebbero dare un importante aiuto ai gestori se gli venisse applicata una logica che, ad esempio, permette di rilevare comportamenti anomali del cane. Si potrebbe inoltre aggiungere un sistema di tracciamento mediante gps in maniera tale da permettere ai volontari o alle famiglie che, nella fase di pre-affidamento, vorrebbero abituare il cane alla loro presenza, di portare il cane a fare una passeggiata, senza temere che il cane possa scappare e perdersi.</p>
<p>Un altro possibile sviluppo riguarda il dispiegamento del sistema su larga scala, affinch&#xE9; possa essere utilizzato da pi&#xF9; canili. A questo punto se si riuscisse ad introdurre un&#x2019;elaborazione migliore delle soglie standard dei consumi e dei parametri vitali, ci si potrebbe basare sulle medie di pi&#xF9; cani, cosa che permetterebbe di evitare che debba essere il veterinario ad impostare manualm,ente le soglie che ritiene pi&#xF9; adeguate per ciascuna cane basandosi su razza, tagli, et&#xE0; e precedenti clinici.</p>
<div id="foorefs" class="references csl-bib-body hanging-indent" role="doc-bibliography">
<div id="fooref-umqtt2" class="csl-entry" role="doc-biblioentry">
8266, UMQTT ESP. s.d. <a href="https://awsiot.wordpress.com/2019/01/10/connect-8266-to-aws-mqtt-using-miropython/">https://awsiot.wordpress.com/2019/01/10/connect-8266-to-aws-mqtt-using-miropython/</a>.
</div>
<div id="fooref-Cors" class="csl-entry" role="doc-biblioentry">
CORS Error, Usefull Issue for. s.d. <a href="https://github.com/aws/aws-sam-cli/issues/323#issuecomment-483650280">https://github.com/aws/aws-sam-cli/issues/323#issuecomment-483650280</a>.
</div>
<div id="fooref-VueJS" class="csl-entry" role="doc-biblioentry">
Docs, VueJS. s.d. <a href="https://vuejs.org/v2/guide/">https://vuejs.org/v2/guide/</a>.
</div>
<div id="fooref-Vuetify" class="csl-entry" role="doc-biblioentry">
Docs, Vuetify. s.d. <a href="https://vuetifyjs.com/en/getting-started/installation/">https://vuetifyjs.com/en/getting-started/installation/</a>.
</div>
<div id="fooref-AWSSAM" class="csl-entry" role="doc-biblioentry">
documentation, AmazonWebServices SAM. s.d. <a href="https://github.com/aws/serverless-application-model/blob/master/versions/2016-10-31.md#api">https://github.com/aws/serverless-application-model/blob/master/versions/2016-10-31.md#api</a>.
</div>
<div id="fooref-Microp" class="csl-entry" role="doc-biblioentry">
Documentation, Micropython. s.d. <a href="https://docs.micropython.org/en/latest/esp32/quickref.html">https://docs.micropython.org/en/latest/esp32/quickref.html</a>.
</div>
<div id="fooref-AWS" class="csl-entry" role="doc-biblioentry">
Documentations, AWS. s.d. <a href="https://docs.aws.amazon.com/index.html">https://docs.aws.amazon.com/index.html</a>.
</div>
<div id="fooref-DynamoDbW" class="csl-entry" role="doc-biblioentry">
DynamoDB, Workbench for. s.d. <a href="https://aws.amazon.com/it/blogs/database/data-modeling-with-nosql-workbench-for-amazon-dynamodb/">https://aws.amazon.com/it/blogs/database/data-modeling-with-nosql-workbench-for-amazon-dynamodb/</a>.
</div>
<div id="fooref-ESP8266MQTT" class="csl-entry" role="doc-biblioentry">
Example, ESP8266 MQTT. s.d. <a href="https://girishjoshi.io/post/esp8266-using-mqtt/">https://girishjoshi.io/post/esp8266-using-mqtt/</a>.
</div>
<div id="fooref-umqtt" class="csl-entry" role="doc-biblioentry">
Example, UMQTT. s.d. <a href="https://mpython.readthedocs.io/en/master/library/mPython/umqtt.simple.html?highlight=umqtt.#module-umqtt.simple">https://mpython.readthedocs.io/en/master/library/mPython/umqtt.simple.html?highlight=umqtt.#module-umqtt.simple</a>.
</div>
<div id="fooref-DynamoDbData" class="csl-entry" role="doc-biblioentry">
Model, DynamoDB Data. s.d. <a href="https://codeburst.io/dynamodb-data-modeling-7f11950b25bf">https://codeburst.io/dynamodb-data-modeling-7f11950b25bf</a>.
</div>
<div id="fooref-yolov3" class="csl-entry" role="doc-biblioentry">
Redmon, Joseph, e Ali Farhadi. 2018. <span>&#xAB;YOLOv3: An Incremental Improvement&#xBB;</span>. <em>arXiv</em>. <a href="https://pjreddie.com/media/files/papers/YOLOv3.pdf">https://pjreddie.com/media/files/papers/YOLOv3.pdf</a>.
</div>
<div id="fooref-WearableH" class="csl-entry" role="doc-biblioentry">
Rita Brugarolas, James Dieffenderfe, Tahmid Latif. s.d. <span>&#xAB;Wearable Heart Rate Sensor Systems for Wireless Canine Health Monitoring&#xBB;</span>. <a href="https://ciigar.csc.ncsu.edu/files/bib/Brugarolas2015-DogHeartMonitor.pdf">https://ciigar.csc.ncsu.edu/files/bib/Brugarolas2015-DogHeartMonitor.pdf</a>.
</div>
<div id="fooref-StackOverflow" class="csl-entry" role="doc-biblioentry">
StackOverflow, Some. s.d. <a href="https://stackoverflow.com/">https://stackoverflow.com/</a>.
</div>
<div id="fooref-AWSTutorialonSAM" class="csl-entry" role="doc-biblioentry">
Tutorial, AmazonWebServices SAM. s.d. <a href="https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/serverless-getting-started-hello-world.html">https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/serverless-getting-started-hello-world.html</a>.
</div>
<div id="fooref-uasyncio" class="csl-entry" role="doc-biblioentry">
uasyncio. s.d. <span>&#xAB;<span> Application of uasyncio to hardware interfaces </span>&#xBB;</span>. <a href="https://github.com/peterhinch/micropython-async/blob/master/v3/docs/TUTORIAL.md">https://github.com/peterhinch/micropython-async/blob/master/v3/docs/TUTORIAL.md</a>.
</div>
</div>
</section>
</section>                    
                </div>
            </div>

            <script src="https://vjs.zencdn.net/5.4.4/video.js"></script>
        </div>
    </body>
</html>
